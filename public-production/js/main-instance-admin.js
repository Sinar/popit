//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*
 * Jeditable - jQuery in place edit plugin
 *
 * Copyright (c) 2006-2009 Mika Tuupola, Dylan Verheul
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/jeditable
 *
 * Based on editable by Dylan Verheul <dylan_at_dyve.net>:
 *    http://www.dyve.net/jquery/?editable
 *
 */

/*!
 * jsoneditor.js
 *
 * @brief
 * JSONEditor is a web-based tool to view, edit, and format JSON.
 * It shows data a clear, editable treeview.
 *
 * Supported browsers: Chrome, Firefox, Safari, Opera, Internet Explorer 8+
 *
 * @license
 * This json editor is open sourced with the intention to use the editor as
 * a component in your own application. Not to just copy and monetize the editor
 * as it is.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 * Copyright (c) 2011-2013 Jos de Jong, http://jsoneditoronline.org
 *
 * @author  Jos de Jong, <wjosdejong@gmail.com>
 * @version 2.2.1
 * @date    2013-05-27
 */

/**
 * Backbone Forms v0.9.0
 *
 * NOTE:
 * This version is for use with RequireJS
 * If using regular <script> tags to include your files, use backbone-forms.min.js
 *
 * Copyright (c) 2012 Charles Davison, Pow Media Ltd
 *
 * License and more information at:
 * http://github.com/powmedia/backbone-forms
 */

/*!
 * fancyBox - jQuery Plugin
 * version: 2.0.6 (16/04/2012)
 * @requires jQuery v1.6 or later
 *
 * Examples at http://fancyapps.com/fancybox/
 * License: www.fancyapps.com/fancybox/#license
 *
 * Copyright 2012 Janis Skarnelis - janis@fancyapps.com
 *
 */

/*
 RequireJS text 1.0.8 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*
 Copyright 2012 Igor Vaynberg

 Version: 3.2 Timestamp: Mon Sep 10 10:38:04 PDT 2012

 Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in
 compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software distributed under the License is
 distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and limitations under the License.
*/

/*!
 * jQuery UI @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */

/*!
 * jQuery UI Widget @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */

/*!
 * jQuery UI Position @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */

/*!
 * jQuery UI Autocomplete @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */

/*
 * jQuery UI Menu (not officially released)
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","jquery.mailcheck":"./libs/jquery.mailcheck.1.0.3.min","jquery.fancybox":"./libs/jquery.fancybox-2.0.6","jquery.jeditable":"./libs/jquery.jeditable-1.7.1","jquery.pulse":"./libs/jquery.pulse","jquery.select2":"./libs/jquery.select2-3.2",jsoneditor:"./libs/jsoneditor/jsoneditor",jqueryui:"./libs/jqueryui-1.8.22",underscore:"./libs/underscore-1.3.3-amd",Backbone:"./libs/backbone-1.0.0-amd","backbone-forms":"./libs/backbone-forms-0.9.0-amd",text:"./libs/requirejs/text-1.0.8.min",order:"./libs/requirejs/order-1.0.5.min"}}),define("require-config",function(){}),define("jquery.mailcheck",["jquery"],function(e){(function(e){e.fn.mailcheck=function(e,n){var r="yahoo.com,google.com,hotmail.com,gmail.com,me.com,aol.com,mac.com,live.com,comcast.net,googlemail.com,msn.com,hotmail.co.uk,yahoo.co.uk,facebook.com,verizon.net,sbcglobal.net,att.net,gmx.com,mail.com".split(","),i="co.uk,com,net,org,info,edu,gov,mil".split(",");if("object"==typeof e&&void 0===n)e.domains=e.domains||r;else{var s=e,e=n;e.domains=s||r}e.topLevelDomains=e.topLevelDomains||i,e.distanceFunction=t.sift3Distance,(r=t.mailcheck.suggest(encodeURI(this.val()),e.domains,e.topLevelDomains,e.distanceFunction))?e.suggested&&e.suggested(this,r):e.empty&&e.empty(this)}})(e);var t={mailcheck:{threshold:3,suggest:function(e,t,n,r){e=e.toLowerCase(),e=this.splitEmail(e);if(t=this.findClosestDomain(e.domain,t,r)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(n=this.findClosestDomain(e.topLevelDomain,n),e.domain&&n&&n!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+n,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,n){var r,i=99,s=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var o=0;o<t.length;o++){if(e===t[o])return e;r=n(e,t[o]),r<i&&(i=r,s=t[o])}return i<=this.threshold&&null!==s?s:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,r=0,i=0,s=0;n+r<e.length&&n+i<t.length;){if(e.charAt(n+r)==t.charAt(n+i))s++;else for(var o=i=r=0;5>o;o++){if(n+o<e.length&&e.charAt(n+o)==t.charAt(n)){r=o;break}if(n+o<t.length&&e.charAt(n)==t.charAt(n+o)){i=o;break}}n++}return(e.length+t.length)/2-s},splitEmail:function(e){e=e.split("@");if(2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var n=e.pop(),r=n.split("."),i="";if(0==r.length)return!1;if(1==r.length)i=r[0];else{for(t=1;t<r.length;t++)i+=r[t]+".";2<=r.length&&(i=i.substring(0,i.length-1))}return{topLevelDomain:i,domain:n,address:e.join("@")}}}}}),require(["jquery","jquery.mailcheck"],function(e){var t=["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com","hotmail.co.uk","yahoo.co.uk","facebook.com","verizon.net","sbcglobal.net","att.net","gmx.com","mail.com","mysociety.org"];e(document).on("change","input[type=email]",function(){var n=e(this),r=n.next(".suggestion");r.length||(r=e('<div class="suggestion" />'),n.after(r).hide()),n.mailcheck({domains:t,suggested:function(e,t){var n="Did you mean <strong>"+t.full+"</strong>?";r.html(n).slideDown()},empty:function(e){r.slideUp()}})})}),define("augmenters/mailchecker",function(){}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}.call(this),require(["jquery","underscore"],function(e,t){e(function(){var n,r=function(){e.getJSON("/migration/progress/"+s,function(t){var r="Imported "+t.progress+" of "+t.total+" items.";t.total===t.progress&&t.count>=0&&(r='Finished importing <a href="/persons" id="_finished">'+t.count+"</a> people.",e("#migration_completed_message").show(),clearInterval(n)),t.err&&t.err.name&&(r="An error occured: <br><pre>"+t.err.name+"\n\n"+t.err.err+"</pre>",e(".progress").addClass("error")),e(".progress").html(r)})};if(e(".progress").html()){var i=window.location.pathname.split("/"),s=i[i.length-1];n=window.setInterval(r,1e3)}e(".history-back").click(function(e){e.preventDefault(),window.history.back()}),e("form.migration-form select").change(function(){var t,n=e(this).parents("tr"),r=e(this).parents("td").next(),i=e(this).find(":selected"),s=i.filter("option[data-suggestions]").attr("data-suggestions"),o=n.attr("id"),u=i.attr("data-strict"),a=typeof u!="undefined"&&u;n.find("datalist").remove(),n.find("select[name=db-attribute]").remove(),n.find(".suggestions").html(""),r.find("input").show().attr("name","db-attribute");if(!s)return;var f=s.split(","),l="<select>";e.each(f,function(e,t){l+="<option>"+t+"</option>"}),l+="</select>";if(a)r.append(l).find("select").attr("name","db-attribute"),r.find("input").attr("name","").hide();else{var c='<datalist id="'+o+'"><select>'+l+"</select></datalist>";n.append(c),n.find("input[name=db-attribute]").attr("list",o),t=f.join(", "),n.find(".suggestions").html(t||"").append(",...")}}),e("form.migration-form").submit(function(){var n=t.zip(e("form.migration-form [name=db-attribute-class]").map(function(t,n){return e(n).val()}),e("form.migration-form [name=db-attribute]").map(function(t,n){return e(n).val()})),r=n.filter(function(e){return e[0]==="name"&&(e[1]==="First name"||e[1]==="Full name")});return r.length===0?(window.alert("You have to provide a column for 'First name'!"),!1):!0}),e("select").change()})}),define("augmenters/migration",function(){}),define("utils/slugify",[],function(){return function(e){return e.replace(/[^a-z0-9\-]+/gi,"-").replace(/-+/g,"-").replace(/-$/,"").replace(/^-/,"").toLowerCase()}}),require(["jquery","utils/slugify"],function(e,t){var n=function(t){return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||t===45||t===32||e.inArray(t,[13,37,39,9,20,46,8])>=0?!0:!1};e(document).on({keypress:function(e){var t=e.which||e.keyCode;return n(t)},change:function(n){var r=e(this).val(),i=t(r);e(this).val(i)}},"input[name=slug]")}),define("augmenters/slug-validation",function(){}),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("Backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.0.0",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=n.uniqueId("l"));return s[o]=t,typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r,i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},n.extend(this,n.pick(t,v)),t.parse&&(i=this.parse(i,t)||{});if(r=n.result(this,"defaults"))i=n.defaults({},i,r);this.set(i,t),this.changed={},this.initialize.apply(this,arguments)},v=["url","urlRoot","collection"];n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=!0);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},F(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t;if(i&&(!r||!r.wait)&&!this.set(i,r))return!1;r=n.extend({validate:!0},r);if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},F(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;F(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||j();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t||{},{validationError:r})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];n.each(m,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var g=t.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},y={add:!0,remove:!0,merge:!0},b={add:!0,merge:!1,remove:!1};n.extend(g.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.defaults(t||{},b))},remove:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},set:function(e,t){t=n.defaults(t||{},y),t.parse&&(e=this.parse(e,t)),n.isArray(e)||(e=e?[e]:[]);var r,i,s,u,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=n.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(r=0,i=e.length;r<i;r++){if(!(s=this._prepareModel(e[r],t)))continue;(f=this.get(s))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(s.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,s.id!=null&&(this._byId[s.id]=s))}if(t.remove){for(r=0,i=this.length;r<i;++r)m[(s=this.models[r]).cid]||v.push(s);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?a.apply(this.models,[c,0].concat(d)):o.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(r=0,i=d.length;r<i;r++)(s=d[r]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return t.previousModels=this.models,this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,r){t||(t=this.comparator);var i=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,i,r)},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var w=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(w,function(e){g.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var E=["groupBy","countBy","sortBy"];n.each(E,function(e){g.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var S=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];n.extend(S.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(x),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,T)),this.options=e},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||j()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);i&&i.apply(s,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e){return e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/;M.started=!1,n.extend(M.prototype,f,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(H,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,u=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search));if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var B=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=g.extend=C.extend=S.extend=M.extend=B;var j=function(){throw new Error('A "url" property or function must be specified')},F=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),define("jquery.jeditable",["jquery"],function($){return $.fn.editable=function(e,t){if("disable"==e){$(this).data("disabled.editable",!0);return}if("enable"==e){$(this).data("disabled.editable",!1);return}if("destroy"==e){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var n=$.extend({},$.fn.editable.defaults,{target:e},t),r=$.editable.types[n.type].plugin||function(){},i=$.editable.types[n.type].submit||function(){},s=$.editable.types[n.type].buttons||$.editable.types.defaults.buttons,o=$.editable.types[n.type].content||$.editable.types.defaults.content,u=$.editable.types[n.type].element||$.editable.types.defaults.element,a=$.editable.types[n.type].reset||$.editable.types.defaults.reset,f=n.callback||function(){},l=n.onedit||function(){},c=n.onsubmit||function(){},h=n.onreset||function(){},p=n.onerror||a;return n.tooltip&&$(this).attr("title",n.tooltip),n.autowidth="auto"==n.width,n.autoheight="auto"==n.height,this.each(function(){var e=this,t=$(e).width(),d=$(e).height();$(this).data("event.editable",n.event),$.trim($(this).html())||$(this).html(n.placeholder),$(this).bind(n.event,function(h){if(!0===$(this).data("disabled.editable"))return;if(e.editing)return;if(!1===l.apply(this,[n,e]))return;h.preventDefault(),h.stopPropagation(),n.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(n.width=t,n.height=d):(n.width!="none"&&(n.width=n.autowidth?$(e).width():n.width),n.height!="none"&&(n.height=n.autoheight?$(e).height():n.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==n.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var v=$("<form />");n.cssclass&&("inherit"==n.cssclass?v.attr("class",$(e).attr("class")):v.attr("class",n.cssclass)),n.style&&("inherit"==n.style?(v.attr("style",$(e).attr("style")),v.css("display",$(e).css("display"))):v.attr("style",n.style));var m=u.apply(v,[n,e]),g;if(n.loadurl){var y=setTimeout(function(){m.disabled=!0,o.apply(v,[n.loadtext,n,e])},100),b={};b[n.id]=e.id,$.isFunction(n.loaddata)?$.extend(b,n.loaddata.apply(e,[e.revert,n])):$.extend(b,n.loaddata),$.ajax({type:n.loadtype,url:n.loadurl,data:b,async:!1,success:function(e){window.clearTimeout(y),g=e,m.disabled=!1}})}else n.data?(g=n.data,$.isFunction(n.data)&&(g=n.data.apply(e,[e.revert,n]))):g=e.revert;o.apply(v,[g,n,e]),m.attr("name",n.name),s.apply(v,[n,e]),$(e).append(v),r.apply(v,[n,e]),$(":input:visible:enabled:first",v).focus(),n.select&&m.select(),m.keydown(function(t){t.keyCode==27&&(t.preventDefault(),a.apply(v,[n,e]))});var y;"cancel"==n.onblur?m.blur(function(t){y=setTimeout(function(){a.apply(v,[n,e])},500)}):"submit"==n.onblur?m.blur(function(e){y=setTimeout(function(){v.submit()},200)}):$.isFunction(n.onblur)?m.blur(function(t){n.onblur.apply(e,[m.val(),n])}):m.blur(function(e){}),v.submit(function(t){y&&clearTimeout(y),t.preventDefault();if(!1!==c.apply(v,[n,e])&&!1!==i.apply(v,[n,e]))if($.isFunction(n.target)){var r=n.target.apply(e,[m.val(),n]);$(e).html(r),e.editing=!1,f.apply(e,[e.innerHTML,n]),$.trim($(e).html())||$(e).html(n.placeholder)}else{var s={};s[n.name]=m.val(),s[n.id]=e.id,$.isFunction(n.submitdata)?$.extend(s,n.submitdata.apply(e,[e.revert,n])):$.extend(s,n.submitdata),"PUT"==n.method&&(s._method="put"),$(e).html(n.indicator);var o={type:"POST",data:s,dataType:"html",url:n.target,success:function(t,r){o.dataType=="html"&&$(e).html(t),e.editing=!1,f.apply(e,[t,n]),$.trim($(e).html())||$(e).html(n.placeholder)},error:function(t,r,i){p.apply(v,[n,e,t])}};$.extend(o,n.ajaxoptions),$.ajax(o)}return $(e).attr("title",n.tooltip),!1})}),this.reset=function(t){this.editing&&!1!==h.apply(t,[n,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(n.placeholder),n.tooltip&&$(e).attr("title",n.tooltip))}})},$.editable={types:{defaults:{element:function(e,t){var n=$('<input type="hidden"></input>');return $(this).append(n),n},content:function(e,t,n){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var n=this;if(e.submit){if(e.submit.match(/>$/))var r=$(e.submit).click(function(){r.attr("type")!="submit"&&n.submit()});else{var r=$('<button type="submit" />');r.html(e.submit)}$(this).append(r)}if(e.cancel){if(e.cancel.match(/>$/))var i=$(e.cancel);else{var i=$('<button type="cancel" />');i.html(e.cancel)}$(this).append(i),$(i).click(function(r){if($.isFunction($.editable.types[e.type].reset))var i=$.editable.types[e.type].reset;else var i=$.editable.types.defaults.reset;return i.apply(n,[e,t]),!1})}}},text:{element:function(e,t){var n=$("<input />");return e.width!="none"&&n.width(e.width),e.height!="none"&&n.height(e.height),n.attr("autocomplete","off"),$(this).append(n),n}},textarea:{element:function(e,t){var n=$("<textarea />");return e.rows?n.attr("rows",e.rows):e.height!="none"&&n.height(e.height),e.cols?n.attr("cols",e.cols):e.width!="none"&&n.width(e.width),$(this).append(n),n}},select:{element:function(e,t){var n=$("<select />");return $(this).append(n),n},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json){if(!json.hasOwnProperty(key))continue;if("selected"==key)continue;var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){($(this).val()==json["selected"]||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}},!0}),require(["Backbone","jquery","jquery.jeditable"],function(e,t){var n=function(n,r){var i=t(this),s=i.attr("data-api-name"),o={};return n||(n=null),o[s]=n,e.trigger("in-place-edit",o),s=="parent_id"&&(n=i.find("option[value="+n+"]").text()),n};t(function(){var e=t("body.signed_in");e.find(".edit-in-place").editable(n,{placeholder:"---",width:"none",height:"none"}),e.find(".edit-in-place-select").editable(n,{placeholder:"---",width:"none",height:"none",loadurl:"/autocomplete/all_orgs",type:"select",submit:"OK"}),e.find(".edit-in-place-textarea").editable(n,{type:"textarea",submit:"OK",onblur:"ignore"})})}),define("augmenters/edit-in-place",function(){}),function(){function e(t,n,r){if(!(this instanceof e))throw new Error('JSONEditor constructor called without "new".');arguments.length&&this._create(t,n,r)}function t(e,n,r){if(!(this instanceof t))throw new Error('TreeEditor constructor called without "new".');this._create(e,n,r)}function n(e,t,r){if(!(this instanceof n))throw new Error('TextEditor constructor called without "new".');this._create(e,t,r)}function r(e,t){this.editor=e,this.dom={},this.expanded=!1,t&&t instanceof Object?(this.setField(t.field,t.fieldEditable),this.setValue(t.value,t.type)):(this.setField(""),this.setValue(null))}function i(e){this.editor=e,this.dom={}}function s(e,t){function a(e,t,r){r.forEach(function(r){if(r.type=="separator"){var i=document.createElement("div");i.className="separator",o=document.createElement("li"),o.appendChild(i),e.appendChild(o)}else{var s={},o=document.createElement("li");e.appendChild(o);var u=document.createElement("button");u.className=r.className,s.button=u,r.title&&(u.title=r.title),r.click&&(u.onclick=function(){n.hide(),r.click()}),o.appendChild(u);if(r.submenu){var f=document.createElement("div");f.className="icon",u.appendChild(f),u.appendChild(document.createTextNode(r.text));var l;if(r.click){u.className+=" default";var c=document.createElement("button");s.buttonExpand=c,c.className="expand",c.innerHTML='<div class="expand"></div>',o.appendChild(c),r.submenuTitle&&(c.title=r.submenuTitle),l=c}else{var h=document.createElement("div");h.className="expand",u.appendChild(h),l=u}l.onclick=function(){n._onExpandItem(s),l.focus()};var p=[];s.subItems=p;var d=document.createElement("ul");s.ul=d,d.className="menu",d.style.height="0",o.appendChild(d),a(d,p,r.submenu)}else u.innerHTML='<div class="icon"></div>'+r.text;t.push(s)}})}this.dom={};var n=this,r=this.dom;this.anchor=undefined,this.items=e,this.eventListeners={},this.selection=undefined,this.visibleSubmenu=undefined,this.onClose=t?t.close:undefined;var i=document.createElement("div");i.className="jsoneditor-contextmenu",r.menu=i;var s=document.createElement("ul");s.className="menu",i.appendChild(s),r.list=s,r.items=[];var o=document.createElement("button");r.focusButton=o;var u=document.createElement("li");u.style.overflow="hidden",u.style.height="0",u.appendChild(o),s.appendChild(u),a(s,this.dom.items,e),this.maxHeight=0,e.forEach(function(t){var r=(e.length+(t.submenu?t.submenu.length:0))*24;n.maxHeight=Math.max(n.maxHeight,r)})}function o(e){this.editor=e,this.clear(),this.actions={editField:{undo:function(e){e.node.updateField(e.oldValue)},redo:function(e){e.node.updateField(e.newValue)}},editValue:{undo:function(e){e.node.updateValue(e.oldValue)},redo:function(e){e.node.updateValue(e.newValue)}},appendNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.appendChild(e.node)}},insertBeforeNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.insertBefore(e.node,e.beforeNode)}},insertAfterNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.insertAfter(e.node,e.afterNode)}},removeNode:{undo:function(e){var t=e.parent,n=t.childs[e.index]||t.append;t.insertBefore(e.node,n)},redo:function(e){e.parent.removeChild(e.node)}},duplicateNode:{undo:function(e){e.parent.removeChild(e.clone)},redo:function(e){e.parent.insertAfter(e.clone,e.node)}},changeType:{undo:function(e){e.node.changeType(e.oldType)},redo:function(e){e.node.changeType(e.newType)}},moveNode:{undo:function(e){e.startParent.moveTo(e.node,e.startIndex)},redo:function(e){e.endParent.moveTo(e.node,e.endIndex)}},sort:{undo:function(e){var t=e.node;t.hideChilds(),t.sort=e.oldSort,t.childs=e.oldChilds,t.showChilds()},redo:function(e){var t=e.node;t.hideChilds(),t.sort=e.newSort,t.childs=e.newChilds,t.showChilds()}}}}function u(e,t){var n=this;this.editor=e,this.timeout=undefined,this.delay=200,this.lastText=undefined,this.dom={},this.dom.container=t;var r=document.createElement("table");this.dom.table=r,r.className="search",t.appendChild(r);var i=document.createElement("tbody");this.dom.tbody=i,r.appendChild(i);var s=document.createElement("tr");i.appendChild(s);var o=document.createElement("td");s.appendChild(o);var u=document.createElement("div");this.dom.results=u,u.className="results",o.appendChild(u),o=document.createElement("td"),s.appendChild(o);var a=document.createElement("div");this.dom.input=a,a.className="frame",a.title="Search fields and values",o.appendChild(a);var f=document.createElement("table");a.appendChild(f);var l=document.createElement("tbody");f.appendChild(l),s=document.createElement("tr"),l.appendChild(s);var c=document.createElement("button");c.className="refresh",o=document.createElement("td"),o.appendChild(c),s.appendChild(o);var h=document.createElement("input");this.dom.search=h,h.oninput=function(e){n._onDelayedSearch(e)},h.onchange=function(e){n._onSearch(e)},h.onkeydown=function(e){n._onKeyDown(e)},h.onkeyup=function(e){n._onKeyUp(e)},c.onclick=function(e){h.select()},o=document.createElement("td"),o.appendChild(h),s.appendChild(o);var p=document.createElement("button");p.title="Next result (Enter)",p.className="next",p.onclick=function(){n.next()},o=document.createElement("td"),o.appendChild(p),s.appendChild(o);var d=document.createElement("button");d.title="Previous result (Shift+Enter)",d.className="previous",d.onclick=function(){n.previous()},o=document.createElement("td"),o.appendChild(d),s.appendChild(o)}function a(){this.locked=!1}e.modes={},e.prototype._create=function(e,t,n){this.container=e,this.options=t||{},this.json=n||{};var r=this.options.mode||"tree";this.setMode(r)},e.prototype._delete=function(){},e.prototype.set=function(e){this.json=e},e.prototype.get=function(){return this.json},e.prototype.setText=function(e){this.json=util.parse(e)},e.prototype.getText=function(){return JSON.stringify(this.json)},e.prototype.setName=function(e){this.options||(this.options={}),this.options.name=e},e.prototype.getName=function(){return this.options&&this.options.name},e.prototype.setMode=function(t){var n=this.container,r=util.extend({},this.options),i,s;r.mode=t;var o=e.modes[t];if(!o)throw new Error('Unknown mode "'+r.mode+'"');try{o.data=="text"?(s=this.getName(),i=this.getText(),this._delete(),util.clear(this),util.extend(this,o.editor.prototype),this._create(n,r),this.setName(s),this.setText(i)):(s=this.getName(),i=this.get(),this._delete(),util.clear(this),util.extend(this,o.editor.prototype),this._create(n,r),this.setName(s),this.set(i));if(typeof o.load=="function")try{o.load.call(this)}catch(u){}}catch(u){this._onError(u)}},e.prototype._onError=function(e){typeof this.onError=="function"&&(util.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(e));if(typeof this.options.error!="function")throw e;this.options.error(e)},t.prototype._create=function(e,t,n){if(typeof JSON=="undefined")throw new Error("Your browser does not support JSON. \n\nPlease install the newest version of your browser.\n(all modern browsers support JSON).");if(!e)throw new Error("No container element provided.");this.container=e,this.dom={},this.highlighter=new a,this.selection=undefined,this._setOptions(t),this.options.history&&!this.mode.view&&(this.history=new o(this)),this._createFrame(),this._createTable(),this.set(n||{})},t.prototype._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},t.prototype._setOptions=function(e){this.options={search:!0,history:!0,mode:"tree",name:undefined};if(e){for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);e.enableSearch&&(this.options.search=e.enableSearch,util.log('WARNING: Option "enableSearch" is deprecated. Use "search" instead.')),e.enableHistory&&(this.options.history=e.enableHistory,util.log('WARNING: Option "enableHistory" is deprecated. Use "history" instead.')),e["mode"]=="editor"&&(this.options.mode="tree",util.log('WARNING: Mode "editor" is deprecated. Use "tree" instead.')),e["mode"]=="viewer"&&(this.options.mode="view",util.log('WARNING: Mode "viewer" is deprecated. Use "view" instead.'))}this.mode={edit:this.options.mode!="view"&&this.options.mode!="form",view:this.options.mode=="view",form:this.options.mode=="form"}},t.focusNode=undefined,t.prototype.set=function(e,t){t&&(util.log('Warning: second parameter "name" is deprecated. Use setName(name) instead.'),this.options.name=t);if(e instanceof Function||e===undefined)this.clear();else{this.content.removeChild(this.table);var n={field:this.options.name,value:e},i=new r(this,n);this._setRoot(i);var s=!1;this.node.expand(s),this.content.appendChild(this.table)}this.history&&this.history.clear()},t.prototype.get=function(){return t.focusNode&&t.focusNode.blur(),this.node?this.node.getValue():undefined},t.prototype.getText=function(){return JSON.stringify(this.get())},t.prototype.setText=function(e){this.set(util.parse(e))},t.prototype.setName=function(e){this.options.name=e,this.node&&this.node.updateField(this.options.name)},t.prototype.getName=function(){return this.options.name},t.prototype.clear=function(){this.node&&(this.node.collapse(),this.tbody.removeChild(this.node.getDom()),delete this.node)},t.prototype._setRoot=function(e){this.clear(),this.node=e,this.tbody.appendChild(e.getDom())},t.prototype.search=function(e){var t;return this.node?(this.content.removeChild(this.table),t=this.node.search(e),this.content.appendChild(this.table)):t=[],t},t.prototype.expandAll=function(){this.node&&(this.content.removeChild(this.table),this.node.expand(),this.content.appendChild(this.table))},t.prototype.collapseAll=function(){this.node&&(this.content.removeChild(this.table),this.node.collapse(),this.content.appendChild(this.table))},t.prototype._onAction=function(e,t){this.history&&this.history.add(e,t);if(this.options.change)try{this.options.change()}catch(n){util.log("Error in change callback: ",n)}},t.prototype.startAutoScroll=function(e){var t=this,n=this.content,r=util.getAbsoluteTop(n),i=n.clientHeight,s=r+i,o=24,u=50;e<r+o&&n.scrollTop>0?this.autoScrollStep=(r+o-e)/3:e>s-o&&i+n.scrollTop<n.scrollHeight?this.autoScrollStep=(s-o-e)/3:this.autoScrollStep=undefined,this.autoScrollStep?this.autoScrollTimer||(this.autoScrollTimer=setInterval(function(){t.autoScrollStep?n.scrollTop-=t.autoScrollStep:t.stopAutoScroll()},u)):this.stopAutoScroll()},t.prototype.stopAutoScroll=function(){this.autoScrollTimer&&(clearTimeout(this.autoScrollTimer),delete this.autoScrollTimer),this.autoScrollStep&&delete this.autoScrollStep},t.prototype.setSelection=function(e){if(!e)return;"scrollTop"in e&&this.content&&(this.content.scrollTop=e.scrollTop),e.range&&util.setSelectionOffset(e.range),e.dom&&e.dom.focus()},t.prototype.getSelection=function(){return{dom:t.domFocus,scrollTop:this.content?this.content.scrollTop:0,range:util.getSelectionOffset()}},t.prototype.scrollTo=function(e,t){var n=this.content;if(n){var r=this;r.animateTimeout&&(clearTimeout(r.animateTimeout),delete r.animateTimeout),r.animateCallback&&(r.animateCallback(!1),delete r.animateCallback);var i=n.clientHeight,s=n.scrollHeight-i,o=Math.min(Math.max(e-i/4,0),s),u=function(){var e=n.scrollTop,i=o-e;Math.abs(i)>3?(n.scrollTop+=i/3,r.animateCallback=t,r.animateTimeout=setTimeout(u,50)):(t&&t(!0),n.scrollTop=o,delete r.animateTimeout,delete r.animateCallback)};u()}else t&&t(!1)},t.prototype._createFrame=function(){this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.container.appendChild(this.frame);var e=this,t=function(t){e._onEvent(t)};this.frame.onclick=function(e){e=e||window.event;var n=e.target||e.srcElement;t(e),n.nodeName=="BUTTON"&&util.preventDefault(e)},this.frame.oninput=t,this.frame.onchange=t,this.frame.onkeydown=t,this.frame.onkeyup=t,this.frame.oncut=t,this.frame.onpaste=t,this.frame.onmousedown=t,this.frame.onmouseup=t,this.frame.onmouseover=t,this.frame.onmouseout=t,util.addEventListener(this.frame,"focus",t,!0),util.addEventListener(this.frame,"blur",t,!0),this.frame.onfocusin=t,this.frame.onfocusout=t,this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu);var n=document.createElement("button");n.className="expand-all",n.title="Expand all fields",n.onclick=function(){e.expandAll()},this.menu.appendChild(n);var r=document.createElement("button");r.title="Collapse all fields",r.className="collapse-all",r.onclick=function(){e.collapseAll()},this.menu.appendChild(r);if(this.history){var i=document.createElement("span");i.innerHTML="&nbsp;",this.menu.appendChild(i);var s=document.createElement("button");s.className="undo",s.title="Undo last action (Ctrl+Z)",s.onclick=function(){e._onUndo()},this.menu.appendChild(s),this.dom.undo=s;var o=document.createElement("button");o.className="redo",o.title="Redo (Ctrl+Shift+Z)",o.onclick=function(){e._onRedo()},this.menu.appendChild(o),this.dom.redo=o,this.history.onChange=function(){s.disabled=!e.history.canUndo(),o.disabled=!e.history.canRedo()},this.history.onChange()}this.options.search&&(this.searchBox=new u(this,this.menu))},t.prototype._onUndo=function(){this.history&&(this.history.undo(),this.options.change&&this.options.change())},t.prototype._onRedo=function(){this.history&&(this.history.redo(),this.options.change&&this.options.change())},t.prototype._onEvent=function(e){e=e||window.event;var n=e.target||e.srcElement;e.type=="keydown"&&this._onKeyDown(e),e.type=="focus"&&(t.domFocus=n);var i=r.getNodeFromTarget(n);i&&i.onEvent(e)},t.prototype._onKeyDown=function(e){var n=e.which||e.keyCode,r=e.ctrlKey,i=e.shiftKey,s=!1;n==9&&setTimeout(function(){util.selectContentEditable(t.domFocus)},0);if(this.searchBox)if(r&&n==70)this.searchBox.dom.search.focus(),this.searchBox.dom.search.select(),s=!0;else if(n==114||r&&n==71){var o=!0;i?this.searchBox.previous(o):this.searchBox.next(o),s=!0}this.history&&(r&&!i&&n==90?(this._onUndo(),s=!0):r&&i&&n==90&&(this._onRedo(),s=!0)),s&&(util.preventDefault(e),util.stopPropagation(e))},t.prototype._createTable=function(){var e=document.createElement("div");e.className="outer",this.contentOuter=e,this.content=document.createElement("div"),this.content.className="content",e.appendChild(this.content),this.table=document.createElement("table"),this.table.className="content",this.content.appendChild(this.table);var t=util.getInternetExplorerVersion();t==8&&(this.content.style.overflow="scroll");var n;this.colgroupContent=document.createElement("colgroup"),this.mode.edit&&(n=document.createElement("col"),n.width="24px",this.colgroupContent.appendChild(n)),n=document.createElement("col"),n.width="24px",this.colgroupContent.appendChild(n),n=document.createElement("col"),this.colgroupContent.appendChild(n),this.table.appendChild(this.colgroupContent),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.frame.appendChild(e)},e.modes.tree={editor:t,data:"json"},e.modes.view={editor:t,data:"json"},e.modes.form={editor:t,data:"json"},e.modes.editor={editor:t,data:"json"},e.modes.viewer={editor:t,data:"json"},n.prototype._create=function(e,t,n){if(typeof JSON=="undefined")throw new Error("Your browser does not support JSON. \n\nPlease install the newest version of your browser.\n(all modern browsers support JSON).");t=t||{},t.indentation&&(this.indentation=Number(t.indentation)),this.options=t||{},this.mode=t.mode=="code"?"code":"text",this.mode=="code"&&(typeof ace=="undefined"&&(this.mode="text",util.log("WARNING: Cannot load code editor, Ace library not loaded. Falling back to plain text editor")),util.getInternetExplorerVersion()==8&&(this.mode="text",util.log("WARNING: Cannot load code editor, Ace is not supported on IE8. Falling back to plain text editor")));var r=this;this.container=e,this.editor=undefined,this.textarea=undefined,this.indentation=4,this.width=e.clientWidth,this.height=e.clientHeight,this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.frame.onclick=function(e){util.preventDefault(e)},this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu);var i=document.createElement("button");i.className="format",i.title="Format JSON data, with proper indentation and line feeds",this.menu.appendChild(i),i.onclick=function(){try{r.format()}catch(e){r._onError(e)}};var s=document.createElement("button");s.className="compact",s.title="Compact JSON data, remove all whitespaces",this.menu.appendChild(s),s.onclick=function(){try{r.compact()}catch(e){r._onError(e)}},this.content=document.createElement("div"),this.content.className="outer",this.frame.appendChild(this.content),this.container.appendChild(this.frame);if(this.mode=="code"){this.editorDom=document.createElement("div"),this.editorDom.style.height="100%",this.editorDom.style.width="100%",this.content.appendChild(this.editorDom);var o=ace.edit(this.editorDom);o.setTheme("ace/theme/jsoneditor"),o.setShowPrintMargin(!1),o.setFontSize(13),o.getSession().setMode("ace/mode/json"),o.getSession().setUseSoftTabs(!0),o.getSession().setUseWrapMode(!0),this.editor=o;var u=document.createElement("a");u.appendChild(document.createTextNode("powered by ace")),u.href="http://ace.ajax.org",u.target="_blank",u.className="poweredBy",u.onclick=function(){window.open(u.href,u.target)},this.menu.appendChild(u),t.change&&o.on("change",function(){t.change()})}else{var a=document.createElement("textarea");a.className="content",a.spellcheck=!1,this.content.appendChild(a),this.textarea=a,t.change&&(this.textarea.oninput===null?this.textarea.oninput=function(){t.change()}:this.textarea.onchange=function(){t.change()})}typeof n=="string"?this.setText(n):this.set(n)},n.prototype._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},n.prototype._onError=function(e){typeof this.onError=="function"&&(util.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(e));if(typeof this.options.error!="function")throw e;this.options.error(e)},n.prototype.compact=function(){var e=util.parse(this.getText());this.setText(JSON.stringify(e))},n.prototype.format=function(){var e=util.parse(this.getText());this.setText(JSON.stringify(e,null,this.indentation))},n.prototype.focus=function(){this.textarea&&this.textarea.focus(),this.editor&&this.editor.focus()},n.prototype.resize=function(){if(this.editor){var e=!1;this.editor.resize(e)}},n.prototype.set=function(e){this.setText(JSON.stringify(e,null,this.indentation))},n.prototype.get=function(){return util.parse(this.getText())},n.prototype.getText=function(){return this.textarea?this.textarea.value:this.editor?this.editor.getValue():""},n.prototype.setText=function(e){this.textarea&&(this.textarea.value=e),this.editor&&this.editor.setValue(e,-1)},e.modes.text={editor:n,data:"text",load:n.prototype.format},e.modes.code={editor:n,data:"text",load:n.prototype.format},r.prototype.setParent=function(e){this.parent=e},r.prototype.setField=function(e,t){this.field=e,this.fieldEditable=t==1},r.prototype.getField=function(){return this.field===undefined&&this._getDomField(),this.field},r.prototype.setValue=function(e,t){var n,i,s=this.childs;if(s)while(s.length)this.removeChild(s[0]);this.type=this._getType(e);if(t&&t!=this.type){if(t!="string"||this.type!="auto")throw new Error('Type mismatch: cannot cast value of type "'+this.type+' to the specified type "'+t+'"');this.type=t}if(this.type=="array"){this.childs=[];for(var o=0,u=e.length;o<u;o++)n=e[o],n!==undefined&&!(n instanceof Function)&&(i=new r(this.editor,{value:n}),this.appendChild(i));this.value=""}else if(this.type=="object"){this.childs=[];for(var a in e)e.hasOwnProperty(a)&&(n=e[a],n!==undefined&&!(n instanceof Function)&&(i=new r(this.editor,{field:a,value:n}),this.appendChild(i)));this.value=""}else this.childs=undefined,this.value=e},r.prototype.getValue=function(){if(this.type=="array"){var e=[];return this.childs.forEach(function(t){e.push(t.getValue())}),e}if(this.type=="object"){var t={};return this.childs.forEach(function(e){t[e.getField()]=e.getValue()}),t}return this.value===undefined&&this._getDomValue(),this.value},r.prototype.getLevel=function(){return this.parent?this.parent.getLevel()+1:0},r.prototype.clone=function(){var e=new r(this.editor);e.type=this.type,e.field=this.field,e.fieldInnerText=this.fieldInnerText,e.fieldEditable=this.fieldEditable,e.value=this.value,e.valueInnerText=this.valueInnerText,e.expanded=this.expanded;if(this.childs){var t=[];this.childs.forEach(function(n){var r=n.clone();r.setParent(e),t.push(r)}),e.childs=t}else e.childs=undefined;return e},r.prototype.expand=function(e){if(!this.childs)return;this.expanded=!0,this.dom.expand&&(this.dom.expand.className="expanded"),this.showChilds(),e!=0&&this.childs.forEach(function(t){t.expand(e)})},r.prototype.collapse=function(e){if(!this.childs)return;this.hideChilds(),e!=0&&this.childs.forEach(function(t){t.collapse(e)}),this.dom.expand&&(this.dom.expand.className="collapsed"),this.expanded=!1},r.prototype.showChilds=function(){var e=this.childs;if(!e)return;if(!this.expanded)return;var t=this.dom.tr,n=t?t.parentNode:undefined;if(n){var r=this.getAppend(),i=t.nextSibling;i?n.insertBefore(r,i):n.appendChild(r),this.childs.forEach(function(e){n.insertBefore(e.getDom(),r),e.showChilds()})}},r.prototype.hide=function(){var e=this.dom.tr,t=e?e.parentNode:undefined;t&&t.removeChild(e),this.hideChilds()},r.prototype.hideChilds=function(){var e=this.childs;if(!e)return;if(!this.expanded)return;var t=this.getAppend();t.parentNode&&t.parentNode.removeChild(t),this.childs.forEach(function(e){e.hide()})},r.prototype.appendChild=function(e){if(this._hasChilds()){e.setParent(this),e.fieldEditable=this.type=="object",this.type=="array"&&(e.index=this.childs.length),this.childs.push(e);if(this.expanded){var t=e.getDom(),n=this.getAppend(),r=n?n.parentNode:undefined;n&&r&&r.insertBefore(t,n),e.showChilds()}this.updateDom({updateIndexes:!0}),e.updateDom({recurse:!0})}},r.prototype.moveBefore=function(e,t){if(this._hasChilds()){var n=this.dom.tr?this.dom.tr.parentNode:undefined;if(n){var r=document.createElement("tr");r.style.height=n.clientHeight+"px",n.appendChild(r)}e.parent&&e.parent.removeChild(e),t instanceof i?this.appendChild(e):this.insertBefore(e,t),n&&n.removeChild(r)}},r.prototype.moveTo=function(e,t){if(e.parent==this){var n=this.childs.indexOf(e);n<t&&t++}var r=this.childs[t]||this.append;this.moveBefore(e,r)},r.prototype.insertBefore=function(e,t){if(this._hasChilds()){if(t==this.append)e.setParent(this),e.fieldEditable=this.type=="object",this.childs.push(e);else{var n=this.childs.indexOf(t);if(n==-1)throw new Error("Node not found");e.setParent(this),e.fieldEditable=this.type=="object",this.childs.splice(n,0,e)}if(this.expanded){var r=e.getDom(),i=t.getDom(),s=i?i.parentNode:undefined;i&&s&&s.insertBefore(r,i),e.showChilds()}this.updateDom({updateIndexes:!0}),e.updateDom({recurse:!0})}},r.prototype.insertAfter=function(e,t){if(this._hasChilds()){var n=this.childs.indexOf(t),r=this.childs[n+1];r?this.insertBefore(e,r):this.appendChild(e)}},r.prototype.search=function(e){var t=[],n,r=e?e.toLowerCase():undefined;delete this.searchField,delete this.searchValue;if(this.field!=undefined){var i=String(this.field).toLowerCase();n=i.indexOf(r),n!=-1&&(this.searchField=!0,t.push({node:this,elem:"field"})),this._updateDomField()}if(this._hasChilds()){if(this.childs){var s=[];this.childs.forEach(function(t){s=s.concat(t.search(e))}),t=t.concat(s)}if(r!=undefined){var o=!1;s.length==0?this.collapse(o):this.expand(o)}}else{if(this.value!=undefined){var u=String(this.value).toLowerCase();n=u.indexOf(r),n!=-1&&(this.searchValue=!0,t.push({node:this,elem:"value"}))}this._updateDomValue()}return t},r.prototype.scrollTo=function(e){if(!this.dom.tr||!this.dom.tr.parentNode){var t=this.parent,n=!1;while(t)t.expand(n),t=t.parent}this.dom.tr&&this.dom.tr.parentNode&&this.editor.scrollTo(this.dom.tr.offsetTop,e)},r.focusElement=undefined,r.prototype.focus=function(e){r.focusElement=e;if(this.dom.tr&&this.dom.tr.parentNode){var t=this.dom;switch(e){case"drag":t.drag?t.drag.focus():t.menu.focus();break;case"menu":t.menu.focus();break;case"expand":this._hasChilds()?t.expand.focus():t.field&&this.fieldEditable?(t.field.focus(),util.selectContentEditable(t.field)):t.value&&!this._hasChilds()?(t.value.focus(),util.selectContentEditable(t.value)):t.menu.focus();break;case"field":t.field&&this.fieldEditable?(t.field.focus(),util.selectContentEditable(t.field)):t.value&&!this._hasChilds()?(t.value.focus(),util.selectContentEditable(t.value)):this._hasChilds()?t.expand.focus():t.menu.focus();break;case"value":default:t.value&&!this._hasChilds()?(t.value.focus(),util.selectContentEditable(t.value)):t.field&&this.fieldEditable?(t.field.focus(),util.selectContentEditable(t.field)):this._hasChilds()?t.expand.focus():t.menu.focus()}}},r.select=function(e){setTimeout(function(){util.selectContentEditable(e)},0)},r.prototype.blur=function(){this._getDomValue(!1),this._getDomField(!1)},r.prototype._duplicate=function(e){var t=e.clone();return this.insertAfter(t,e),t},r.prototype.containsNode=function(e){if(this==e)return!0;var t=this.childs;if(t)for(var n=0,r=t.length;n<r;n++)if(t[n].containsNode(e))return!0;return!1},r.prototype._move=function(e,t){if(e==t)return;if(e.containsNode(this))throw new Error("Cannot move a field into a child of itself");e.parent&&e.parent.removeChild(e);var n=e.clone();e.clearDom(),t?this.insertBefore(n,t):this.appendChild(n)},r.prototype.removeChild=function(e){if(this.childs){var t=this.childs.indexOf(e);if(t!=-1){e.hide(),delete e.searchField,delete e.searchValue;var n=this.childs.splice(t,1)[0];return this.updateDom({updateIndexes:!0}),n}}return undefined},r.prototype._remove=function(e){this.removeChild(e)},r.prototype.changeType=function(e){var t=this.type;if(t==e)return;if(e!="string"&&e!="auto"||t!="string"&&t!="auto"){var n=this.dom.tr?this.dom.tr.parentNode:undefined,r;this.expanded?r=this.getAppend():r=this.getDom();var i=r&&r.parentNode?r.nextSibling:undefined;this.hide(),this.clearDom(),this.type=e;if(e=="object"){this.childs||(this.childs=[]),this.childs.forEach(function(e,t){e.clearDom(),delete e.index,e.fieldEditable=!0,e.field==undefined&&(e.field="")});if(t=="string"||t=="auto")this.expanded=!0}else if(e=="array"){this.childs||(this.childs=[]),this.childs.forEach(function(e,t){e.clearDom(),e.fieldEditable=!1,e.index=t});if(t=="string"||t=="auto")this.expanded=!0}else this.expanded=!1;n&&(i?n.insertBefore(this.getDom(),i):n.appendChild(this.getDom())),this.showChilds()}else this.type=e;if(e=="auto"||e=="string")e=="string"?this.value=String(this.value):this.value=this._stringCast(String(this.value)),this.focus();this.updateDom({updateIndexes:!0})},r.prototype._getDomValue=function(e){this.dom.value&&this.type!="array"&&this.type!="object"&&(this.valueInnerText=util.getInnerText(this.dom.value));if(this.valueInnerText!=undefined)try{var t;if(this.type=="string")t=this._unescapeHTML(this.valueInnerText);else{var n=this._unescapeHTML(this.valueInnerText);t=this._stringCast(n)}if(t!==this.value){var r=this.value;this.value=t,this.editor._onAction("editValue",{node:this,oldValue:r,newValue:t,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()})}}catch(i){this.value=undefined;if(e!=1)throw i}},r.prototype._updateDomValue=function(){var e=this.dom.value;if(e){var t=this.value,n=this.type=="auto"?typeof t:this.type,r=n=="string"&&util.isUrl(t),i="";r&&!this.editor.mode.edit?i="":n=="string"?i="green":n=="number"?i="red":n=="boolean"?i="orange":this._hasChilds()?i="":t===null?i="#004ED0":i="black",e.style.color=i;var s=String(this.value)==""&&this.type!="array"&&this.type!="object";s?util.addClassName(e,"empty"):util.removeClassName(e,"empty"),r?util.addClassName(e,"url"):util.removeClassName(e,"url");if(n=="array"||n=="object"){var o=this.childs?this.childs.length:0;e.title=this.type+" containing "+o+" items"}else n=="string"&&util.isUrl(t)?this.editor.mode.edit&&(e.title="Ctrl+Click or Ctrl+Enter to open url in new window"):e.title="";this.searchValueActive?util.addClassName(e,"highlight-active"):util.removeClassName(e,"highlight-active"),this.searchValue?util.addClassName(e,"highlight"):util.removeClassName(e,"highlight"),util.stripFormatting(e)}},r.prototype._updateDomField=function(){var e=this.dom.field;if(e){var t=String(this.field)==""&&this.parent.type!="array";t?util.addClassName(e,"empty"):util.removeClassName(e,"empty"),this.searchFieldActive?util.addClassName(e,"highlight-active"):util.removeClassName(e,"highlight-active"),this.searchField?util.addClassName(e,"highlight"):util.removeClassName(e,"highlight"),util.stripFormatting(e)}},r.prototype._getDomField=function(e){this.dom.field&&this.fieldEditable&&(this.fieldInnerText=util.getInnerText(this.dom.field));if(this.fieldInnerText!=undefined)try{var t=this._unescapeHTML(this.fieldInnerText);if(t!==this.field){var n=this.field;this.field=t,this.editor._onAction("editField",{node:this,oldValue:n,newValue:t,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()})}}catch(r){this.field=undefined;if(e!=1)throw r}},r.prototype.clearDom=function(){this.dom={}},r.prototype.getDom=function(){var e=this.dom;if(e.tr)return e.tr;e.tr=document.createElement("tr"),e.tr.node=this;if(this.editor.mode.edit){var t=document.createElement("td");if(this.parent){var n=document.createElement("button");e.drag=n,n.className="dragarea",n.title="Drag to move this field (Alt+Shift+Arrows)",t.appendChild(n)}e.tr.appendChild(t);var r=document.createElement("td"),i=document.createElement("button");e.menu=i,i.className="contextmenu",i.title="Click to open the actions menu (Ctrl+M)",r.appendChild(e.menu),e.tr.appendChild(r)}var s=document.createElement("td");return e.tr.appendChild(s),e.tree=this._createDomTree(),s.appendChild(e.tree),this.updateDom({updateIndexes:!0}),e.tr},r.prototype._onDragStart=function(e){e=e||window.event;var t=this;this.mousemove||(this.mousemove=util.addEventListener(document,"mousemove",function(e){t._onDrag(e)})),this.mouseup||(this.mouseup=util.addEventListener(document,"mouseup",function(e){t._onDragEnd(e)})),this.editor.highlighter.lock(),this.drag={oldCursor:document.body.style.cursor,startParent:this.parent,startIndex:this.parent.childs.indexOf(this),mouseX:util.getMouseX(e),level:this.getLevel()},document.body.style.cursor="move",util.preventDefault(e)},r.prototype._onDrag=function(e){e=e||window.event;var t=util.getMouseY(e),n=util.getMouseX(e),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=!1;s=this.dom.tr,p=util.getAbsoluteTop(s),m=s.offsetHeight;if(t<p){o=s;do o=o.previousSibling,c=r.getNodeFromTarget(o),d=o?util.getAbsoluteTop(o):0;while(o&&t<d);c&&!c.parent&&(c=undefined),c||(l=s.parentNode.firstChild,o=l?l.nextSibling:undefined,c=r.getNodeFromTarget(o),c==this&&(c=undefined)),c&&(o=c.dom.tr,d=o?util.getAbsoluteTop(o):0,t>d+m&&(c=undefined)),c&&(c.parent.moveBefore(this,c),b=!0)}else{f=this.expanded&&this.append?this.append.getDom():this.dom.tr,a=f?f.nextSibling:undefined;if(a){v=util.getAbsoluteTop(a),u=a;do h=r.getNodeFromTarget(u),u&&(g=u.nextSibling?util.getAbsoluteTop(u.nextSibling):0,y=u?g-v:0,h.parent.childs.length==1&&h.parent.childs[0]==this&&(p+=23)),u=u.nextSibling;while(u&&t>p+y);if(h&&h.parent){var w=n-this.drag.mouseX,E=Math.round(w/24/2),S=this.drag.level+E,x=h.getLevel();o=h.dom.tr.previousSibling;while(x<S&&o){c=r.getNodeFromTarget(o);if(c!=this&&!c._isChildOf(this)){if(!(c instanceof i))break;var T=c.parent.childs;if(!(T.length>1||T.length==1&&T[0]!=this))break;h=r.getNodeFromTarget(o),x=h.getLevel()}o=o.previousSibling}f.nextSibling!=h.dom.tr&&(h.parent.moveBefore(this,h),b=!0)}}}b&&(this.drag.mouseX=n,this.drag.level=this.getLevel()),this.editor.startAutoScroll(t),util.preventDefault(e)},r.prototype._onDragEnd=function(e){e=e||window.event;var t={node:this,startParent:this.drag.startParent,startIndex:this.drag.startIndex,endParent:this.parent,endIndex:this.parent.childs.indexOf(this)};(t.startParent!=t.endParent||t.startIndex!=t.endIndex)&&this.editor._onAction("moveNode",t),document.body.style.cursor=this.drag.oldCursor,this.editor.highlighter.unlock(),delete this.drag,this.mousemove&&(util.removeEventListener(document,"mousemove",this.mousemove),delete this.mousemove),this.mouseup&&(util.removeEventListener(document,"mouseup",this.mouseup),delete this.mouseup),this.editor.stopAutoScroll(),util.preventDefault(e)},r.prototype._isChildOf=function(e){var t=this.parent;while(t){if(t==e)return!0;t=t.parent}return!1},r.prototype._createDomField=function(){return document.createElement("div")},r.prototype.setHighlight=function(e){this.dom.tr&&(this.dom.tr.className=e?"highlight":"",this.append&&this.append.setHighlight(e),this.childs&&this.childs.forEach(function(t){t.setHighlight(e)}))},r.prototype.updateValue=function(e){this.value=e,this.updateDom()},r.prototype.updateField=function(e){this.field=e,this.updateDom()},r.prototype.updateDom=function(e){var t=this.dom.tree;t&&(t.style.marginLeft=this.getLevel()*24+"px");var n=this.dom.field;if(n){this.fieldEditable==1?(n.contentEditable=this.editor.mode.edit,n.spellcheck=!1,n.className="field"):n.className="readonly";var r;this.index!=undefined?r=this.index:this.field!=undefined?r=this.field:this._hasChilds()?r=this.type:r="",n.innerHTML=this._escapeHTML(r)}var i=this.dom.value;if(i){var s=this.childs?this.childs.length:0;this.type=="array"?i.innerHTML="["+s+"]":this.type=="object"?i.innerHTML="{"+s+"}":i.innerHTML=this._escapeHTML(this.value)}this._updateDomField(),this._updateDomValue(),e&&e.updateIndexes==1&&this._updateDomIndexes(),e&&e.recurse==1&&this.childs&&this.childs.forEach(function(t){t.updateDom(e)}),this.append&&this.append.updateDom()},r.prototype._updateDomIndexes=function(){var e=this.dom.value,t=this.childs;e&&t&&(this.type=="array"?t.forEach(function(e,t){e.index=t;var n=e.dom.field;n&&(n.innerHTML=t)}):this.type=="object"&&t.forEach(function(e){e.index!=undefined&&(delete e.index,e.field==undefined&&(e.field=""))}))},r.prototype._createDomValue=function(){var e;return this.type=="array"?(e=document.createElement("div"),e.className="readonly",e.innerHTML="[...]"):this.type=="object"?(e=document.createElement("div"),e.className="readonly",e.innerHTML="{...}"):!this.editor.mode.edit&&util.isUrl(this.value)?(e=document.createElement("a"),e.className="value",e.href=this.value,e.target="_blank",e.innerHTML=this._escapeHTML(this.value)):(e=document.createElement("div"),e.contentEditable=!this.editor.mode.view,e.spellcheck=!1,e.className="value",e.innerHTML=this._escapeHTML(this.value)),e},r.prototype._createDomExpandButton=function(){var e=document.createElement("button");return this._hasChilds()?(e.className=this.expanded?"expanded":"collapsed",e.title="Click to expand/collapse this field (Ctrl+E). \nCtrl+Click to expand/collapse including all childs."):(e.className="invisible",e.title=""),e},r.prototype._createDomTree=function(){var e=this.dom,t=document.createElement("table"),n=document.createElement("tbody");t.style.borderCollapse="collapse",t.appendChild(n);var r=document.createElement("tr");n.appendChild(r);var i=document.createElement("td");i.className="tree",r.appendChild(i),e.expand=this._createDomExpandButton(),i.appendChild(e.expand),e.tdExpand=i;var s=document.createElement("td");s.className="tree",r.appendChild(s),e.field=this._createDomField(),s.appendChild(e.field),e.tdField=s;var o=document.createElement("td");o.className="tree",r.appendChild(o),this.type!="object"&&this.type!="array"&&(o.appendChild(document.createTextNode(":")),o.className="separator"),e.tdSeparator=o;var u=document.createElement("td");return u.className="tree",r.appendChild(u),e.value=this._createDomValue(),u.appendChild(e.value),e.tdValue=u,t},r.prototype.onEvent=function(e){var t=e.type,n=e.target||e.srcElement,r=this.dom,i=this,s,o=this._hasChilds();if(n==r.drag||n==r.menu)t=="mouseover"?this.editor.highlighter.highlight(this):t=="mouseout"&&this.editor.highlighter.unhighlight();t=="mousedown"&&n==r.drag&&this._onDragStart(e);if(t=="click"&&n==r.menu){var u=i.editor.highlighter;u.highlight(i),u.lock(),util.addClassName(r.menu,"selected"),this.showContextMenu(r.menu,function(){util.removeClassName(r.menu,"selected"),u.unlock(),u.unhighlight()})}if(t=="click"&&n==r.expand&&o){var a=e.ctrlKey;this._onExpand(a)}var f=r.value;if(n==f)switch(t){case"focus":s=this;break;case"blur":case"change":this._getDomValue(!0),this._updateDomValue(),this.value&&(f.innerHTML=this._escapeHTML(this.value));break;case"input":this._getDomValue(!0),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"click":e.ctrlKey&&this.editor.mode.edit&&util.isUrl(this.value)&&window.open(this.value,"_blank");break;case"keyup":this._getDomValue(!0),this._updateDomValue();break;case"cut":case"paste":setTimeout(function(){i._getDomValue(!0),i._updateDomValue()},1)}var l=r.field;if(n==l)switch(t){case"focus":s=this;break;case"blur":case"change":this._getDomField(!0),this._updateDomField(),this.field&&(l.innerHTML=this._escapeHTML(this.field));break;case"input":this._getDomField(!0),this._updateDomField();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"keyup":this._getDomField(!0),this._updateDomField();break;case"cut":case"paste":setTimeout(function(){i._getDomField(!0),i._updateDomField()},1)}var c=r.tree;if(n==c.parentNode)switch(t){case"click":var h=e.offsetX!=undefined?e.offsetX<(this.getLevel()+1)*24:util.getMouseX(e)<util.getAbsoluteLeft(r.tdSeparator);h||o?l&&(util.setEndOfContentEditable(l),l.focus()):f&&(util.setEndOfContentEditable(f),f.focus())}if(n==r.tdExpand&&!o||n==r.tdField||n==r.tdSeparator)switch(t){case"click":l&&(util.setEndOfContentEditable(l),l.focus())}t=="keydown"&&this.onKeyDown(e)},r.prototype.onKeyDown=function(e){var t=e.which||e.keyCode,n=e.target||e.srcElement,s=e.ctrlKey,o=e.shiftKey,u=e.altKey,a=!1,f,l,c,h;if(t==13){if(n==this.dom.value)(!this.editor.mode.edit||e.ctrlKey)&&util.isUrl(this.value)&&(window.open(this.value,"_blank"),a=!0);else if(n==this.dom.expand){var p=this._hasChilds();if(p){var d=e.ctrlKey;this._onExpand(d),n.focus(),a=!0}}}else if(t==68)s&&(this._onDuplicate(),a=!0);else if(t==69)s&&(this._onExpand(o),n.focus(),a=!0);else if(t==77)s&&(this.showContextMenu(n),a=!0);else if(t==46)s&&(this._onRemove(),a=!0);else if(t==45)s&&!o?(this._onInsertBefore(),a=!0):s&&o&&(this._onInsertAfter(),a=!0);else if(t==35){if(u){var v=this._lastNode();v&&v.focus(r.focusElement||this._getElementName(n)),a=!0}}else if(t==36){if(u){var m=this._firstNode();m&&m.focus(r.focusElement||this._getElementName(n)),a=!0}}else if(t==37){if(u&&!o){var g=this._previousElement(n);g&&this.focus(this._getElementName(g)),a=!0}else if(u&&o){if(this.expanded){var y=this.getAppend();c=y?y.nextSibling:undefined}else{var b=this.getDom();c=b.nextSibling}c&&(l=r.getNodeFromTarget(c),h=c.nextSibling,S=r.getNodeFromTarget(h),l&&l instanceof i&&this.parent.childs.length!=1&&S&&S.parent&&(S.parent.moveBefore(this,S),this.focus(r.focusElement||this._getElementName(n))))}}else if(t==38)u&&!o?(f=this._previousNode(),f&&f.focus(r.focusElement||this._getElementName(n)),a=!0):u&&o&&(f=this._previousNode(),f&&f.parent&&(f.parent.moveBefore(this,f),this.focus(r.focusElement||this._getElementName(n))),a=!0);else if(t==39){if(u&&!o){var w=this._nextElement(n);w&&this.focus(this._getElementName(w)),a=!0}else if(u&&o){b=this.getDom();var E=b.previousSibling;E&&(f=r.getNodeFromTarget(E),f&&f.parent&&f instanceof i&&!f.isVisible()&&(f.parent.moveBefore(this,f),this.focus(r.focusElement||this._getElementName(n))))}}else if(t==40)if(u&&!o)l=this._nextNode(),l&&l.focus(r.focusElement||this._getElementName(n)),a=!0;else if(u&&o){this.expanded?l=this.append?this.append._nextNode():undefined:l=this._nextNode(),c=l?l.getDom():undefined,this.parent.childs.length==1?h=c:h=c?c.nextSibling:undefined;var S=r.getNodeFromTarget(h);S&&S.parent&&(S.parent.moveBefore(this,S),this.focus(r.focusElement||this._getElementName(n))),a=!0}a&&(util.preventDefault(e),util.stopPropagation(e))},r.prototype._onExpand=function(e){if(e){var t=this.dom.tr.parentNode,n=t.parentNode,r=n.scrollTop;n.removeChild(t)}this.expanded?this.collapse(e):this.expand(e),e&&(n.appendChild(t),n.scrollTop=r)},r.prototype._onRemove=function(){this.editor.highlighter.unhighlight();var e=this.parent.childs,t=e.indexOf(this),n=this.editor.getSelection();e[t+1]?e[t+1].focus():e[t-1]?e[t-1].focus():this.parent.focus();var r=this.editor.getSelection();this.parent._remove(this),this.editor._onAction("removeNode",{node:this,parent:this.parent,index:t,oldSelection:n,newSelection:r})},r.prototype._onDuplicate=function(){var e=this.editor.getSelection(),t=this.parent._duplicate(this);t.focus();var n=this.editor.getSelection();this.editor._onAction("duplicateNode",{node:this,clone:t,parent:this.parent,oldSelection:e,newSelection:n})},r.prototype._onInsertBefore=function(e,t,n){var i=this.editor.getSelection(),s=new r(this.editor,{field:e!=undefined?e:"",value:t!=undefined?t:"",type:n});s.expand(!0),this.parent.insertBefore(s,this),this.editor.highlighter.unhighlight(),s.focus("field");var o=this.editor.getSelection();this.editor._onAction("insertBeforeNode",{node:s,beforeNode:this,parent:this.parent,oldSelection:i,newSelection:o})},r.prototype._onInsertAfter=function(e,t,n){var i=this.editor.getSelection(),s=new r(this.editor,{field:e!=undefined?e:"",value:t!=undefined?t:"",type:n});s.expand(!0),this.parent.insertAfter(s,this),this.editor.highlighter.unhighlight(),s.focus("field");var o=this.editor.getSelection();this.editor._onAction("insertAfterNode",{node:s,afterNode:this,parent:this.parent,oldSelection:i,newSelection:o})},r.prototype._onAppend=function(e,t,n){var i=this.editor.getSelection(),s=new r(this.editor,{field:e!=undefined?e:"",value:t!=undefined?t:"",type:n});s.expand(!0),this.parent.appendChild(s),this.editor.highlighter.unhighlight(),s.focus("field");var o=this.editor.getSelection();this.editor._onAction("appendNode",{node:s,parent:this.parent,oldSelection:i,newSelection:o})},r.prototype._onChangeType=function(e){var t=this.type;if(e!=t){var n=this.editor.getSelection();this.changeType(e);var r=this.editor.getSelection();this.editor._onAction("changeType",{node:this,oldType:t,newType:e,oldSelection:n,newSelection:r})}},r.prototype._onSort=function(e){if(this._hasChilds()){var t=e=="desc"?-1:1,n=this.type=="array"?"value":"field";this.hideChilds();var r=this.childs,i=this.sort;this.childs=this.childs.concat(),this.childs.sort(function(e,r){return e[n]>r[n]?t:e[n]<r[n]?-t:0}),this.sort=t==1?"asc":"desc",this.editor._onAction("sort",{node:this,oldChilds:r,oldSort:i,newChilds:this.childs,newSort:this.sort}),this.showChilds()}},r.prototype.getAppend=function(){return this.append||(this.append=new i(this.editor),this.append.setParent(this)),this.append.getDom()},r.getNodeFromTarget=function(e){while(e){if(e.node)return e.node;e=e.parentNode}return undefined},r.prototype._previousNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var n=t;do n=n.previousSibling,e=r.getNodeFromTarget(n);while(n&&e instanceof i&&!e.isVisible())}return e},r.prototype._nextNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var n=t;do n=n.nextSibling,e=r.getNodeFromTarget(n);while(n&&e instanceof i&&!e.isVisible())}return e},r.prototype._firstNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var n=t.parentNode.firstChild;e=r.getNodeFromTarget(n)}return e},r.prototype._lastNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var n=t.parentNode.lastChild;e=r.getNodeFromTarget(n);while(n&&e instanceof i&&!e.isVisible())n=n.previousSibling,e=r.getNodeFromTarget(n)}return e},r.prototype._previousElement=function(e){var t=this.dom;switch(e){case t.value:if(this.fieldEditable)return t.field;case t.field:if(this._hasChilds())return t.expand;case t.expand:return t.menu;case t.menu:if(t.drag)return t.drag;default:return null}},r.prototype._nextElement=function(e){var t=this.dom;switch(e){case t.drag:return t.menu;case t.menu:if(this._hasChilds())return t.expand;case t.expand:if(this.fieldEditable)return t.field;case t.field:if(!this._hasChilds())return t.value;default:return null}},r.prototype._getElementName=function(e){var t=this.dom;for(var n in t)if(t.hasOwnProperty(n)&&t[n]==e)return n;return null},r.prototype._hasChilds=function(){return this.type=="array"||this.type=="object"},r.TYPE_TITLES={auto:'Field type "auto". The field type is automatically determined from the value and can be a string, number, boolean, or null.',object:'Field type "object". An object contains an unordered set of key/value pairs.',array:'Field type "array". An array contains an ordered collection of values.',string:'Field type "string". Field type is not determined from the value, but always returned as string.'},r.prototype.showContextMenu=function(e,t){var n=this,i=r.TYPE_TITLES,o=[];o.push({text:"Type",title:"Change the type of this field",className:"type-"+this.type,submenu:[{text:"Auto",className:"type-auto"+(this.type=="auto"?" selected":""),title:i.auto,click:function(){n._onChangeType("auto")}},{text:"Array",className:"type-array"+(this.type=="array"?" selected":""),title:i.array,click:function(){n._onChangeType("array")}},{text:"Object",className:"type-object"+(this.type=="object"?" selected":""),title:i.object,click:function(){n._onChangeType("object")}},{text:"String",className:"type-string"+(this.type=="string"?" selected":""),title:i.string,click:function(){n._onChangeType("string")}}]});if(this._hasChilds()){var u=this.sort=="asc"?"desc":"asc";o.push({text:"Sort",title:"Sort the childs of this "+this.type,className:"sort-"+u,click:function(){n._onSort(u)},submenu:[{text:"Ascending",className:"sort-asc",title:"Sort the childs of this "+this.type+" in ascending order",click:function(){n._onSort("asc")}},{text:"Descending",className:"sort-desc",title:"Sort the childs of this "+this.type+" in descending order",click:function(){n._onSort("desc")}}]})}if(this.parent&&this.parent._hasChilds()){o.push({type:"separator"});var a=n.parent.childs;n==a[a.length-1]&&o.push({text:"Append",title:"Append a new field with type 'auto' after this field (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"append",click:function(){n._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:i.auto,click:function(){n._onAppend("","","auto")}},{text:"Array",className:"type-array",title:i.array,click:function(){n._onAppend("",[])}},{text:"Object",className:"type-object",title:i.object,click:function(){n._onAppend("",{})}},{text:"String",className:"type-string",title:i.string,click:function(){n._onAppend("","","string")}}]}),o.push({text:"Insert",title:"Insert a new field with type 'auto' before this field (Ctrl+Ins)",submenuTitle:"Select the type of the field to be inserted",className:"insert",click:function(){n._onInsertBefore("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:i.auto,click:function(){n._onInsertBefore("","","auto")}},{text:"Array",className:"type-array",title:i.array,click:function(){n._onInsertBefore("",[])}},{text:"Object",className:"type-object",title:i.object,click:function(){n._onInsertBefore("",{})}},{text:"String",className:"type-string",title:i.string,click:function(){n._onInsertBefore("","","string")}}]}),o.push({text:"Duplicate",title:"Duplicate this field (Ctrl+D)",className:"duplicate",click:function(){n._onDuplicate()}}),o.push({text:"Remove",title:"Remove this field (Ctrl+Del)",className:"remove",click:function(){n._onRemove()}})}var f=new s(o,{close:t});f.show(e)},r.prototype._getType=function(e){return e instanceof Array?"array":e instanceof Object?"object":typeof e=="string"&&typeof this._stringCast(e)!="string"?"string":"auto"},r.prototype._stringCast=function(e){var t=e.toLowerCase(),n=Number(e),r=parseFloat(e);return e==""?"":t=="null"?null:t=="true"?!0:t=="false"?!1:!isNaN(n)&&!isNaN(r)?n:e},r.prototype._escapeHTML=function(e){var t=String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/  /g," &nbsp;").replace(/^ /,"&nbsp;").replace(/ $/,"&nbsp;"),n=JSON.stringify(t);return n.substring(1,n.length-1)},r.prototype._unescapeHTML=function(e){var t='"'+this._escapeJSON(e)+'"',n=util.parse(t);return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ")},r.prototype._escapeJSON=function(e){var t="",n=0,r=e.length;while(n<r){var i=e.charAt(n);i=="\n"?t+="\\n":i=="\\"?(t+=i,n++,i=e.charAt(n),'"\\/bfnrtu'.indexOf(i)==-1&&(t+="\\"),t+=i):i=='"'?t+='\\"':t+=i,n++}return t},i.prototype=new r,i.prototype.getDom=function(){var e=this.dom;if(e.tr)return e.tr;var t=document.createElement("tr");t.node=this,e.tr=t;if(this.editor.mode.edit){e.tdDrag=document.createElement("td");var n=document.createElement("td");e.tdMenu=n;var r=document.createElement("button");r.className="contextmenu",r.title="Click to open the actions menu (Ctrl+M)",e.menu=r,n.appendChild(e.menu)}var i=document.createElement("td"),s=document.createElement("div");return s.innerHTML="(empty)",s.className="readonly",i.appendChild(s),e.td=i,e.text=s,this.updateDom(),t},i.prototype.updateDom=function(){var e=this.dom,t=e.td;t&&(t.style.paddingLeft=this.getLevel()*24+26+"px");var n=e.text;n&&(n.innerHTML="(empty "+this.parent.type+")");var r=e.tr;this.isVisible()?e.tr.firstChild||(e.tdDrag&&r.appendChild(e.tdDrag),e.tdMenu&&r.appendChild(e.tdMenu),r.appendChild(t)):e.tr.firstChild&&(e.tdDrag&&r.removeChild(e.tdDrag),e.tdMenu&&r.removeChild(e.tdMenu),r.removeChild(t))},i.prototype.isVisible=function(){return this.parent.childs.length==0},i.prototype.showContextMenu=function(e,t){var n=this,i=r.TYPE_TITLES,o=[{text:"Append",title:"Append a new field with type 'auto' (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"insert",click:function(){n._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:i.auto,click:function(){n._onAppend("","","auto")}},{text:"Array",className:"type-array",title:i.array,click:function(){n._onAppend("",[])}},{text:"Object",className:"type-object",title:i.object,click:function(){n._onAppend("",{})}},{text:"String",className:"type-string",title:i.string,click:function(){n._onAppend("","","string")}}]}],u=new s(o,{close:t});u.show(e)},i.prototype.onEvent=function(e){var t=e.type,n=e.target||e.srcElement,r=this.dom,i=r.menu;n==i&&(t=="mouseover"?this.editor.highlighter.highlight(this.parent):t=="mouseout"&&this.editor.highlighter.unhighlight());if(t=="click"&&n==r.menu){var s=this.editor.highlighter;s.highlight(this.parent),s.lock(),util.addClassName(r.menu,"selected"),this.showContextMenu(r.menu,function(){util.removeClassName(r.menu,"selected"),s.unlock(),s.unhighlight()})}t=="keydown"&&this.onKeyDown(e)},s.prototype._getVisibleButtons=function(){var e=[],t=this;return this.dom.items.forEach(function(n){e.push(n.button),n.buttonExpand&&e.push(n.buttonExpand),n.subItems&&n==t.expandedItem&&n.subItems.forEach(function(t){e.push(t.button),t.buttonExpand&&e.push(t.buttonExpand)})}),e},s.visibleMenu=undefined,s.prototype.show=function(e){this.hide();var t=util.getWindowHeight(),n=e.offsetHeight,r=this.maxHeight,i=util.getAbsoluteLeft(e),o=util.getAbsoluteTop(e);o+n+r<t?(this.dom.menu.style.left=i+"px",this.dom.menu.style.top=o+n+"px",this.dom.menu.style.bottom=""):(this.dom.menu.style.left=i+"px",this.dom.menu.style.top="",this.dom.menu.style.bottom=t-o+"px"),document.body.appendChild(this.dom.menu);var u=this,a=this.dom.list;this.eventListeners.mousedown=util.addEventListener(document,"mousedown",function(e){e=e||window.event;var t=e.target||e.srcElement;t!=a&&!u._isChildOf(t,a)&&(u.hide(),util.stopPropagation(e),util.preventDefault(e))}),this.eventListeners.mousewheel=util.addEventListener(document,"mousewheel",function(){util.stopPropagation(event),util.preventDefault(event)}),this.eventListeners.keydown=util.addEventListener(document,"keydown",function(e){u._onKeyDown(e)}),this.selection=util.getSelection(),this.anchor=e,setTimeout(function(){u.dom.focusButton.focus()},0),s.visibleMenu&&s.visibleMenu.hide(),s.visibleMenu=this},s.prototype.hide=function(){this.dom.menu.parentNode&&(this.dom.menu.parentNode.removeChild(this.dom.menu),this.onClose&&this.onClose());for(var e in this.eventListeners)if(this.eventListeners.hasOwnProperty(e)){var t=this.eventListeners[e];t&&util.removeEventListener(document,e,t),delete this.eventListeners[e]}s.visibleMenu==this&&(s.visibleMenu=undefined)},s.prototype._onExpandItem=function(e){var t=this,n=e==this.expandedItem,r=this.expandedItem;r&&(r.ul.style.height="0",r.ul.style.padding="",setTimeout(function(){t.expandedItem!=r&&(r.ul.style.display="",util.removeClassName(r.ul.parentNode,"selected"))},300),this.expandedItem=undefined);if(!n){var i=e.ul;i.style.display="block";var s=i.clientHeight;setTimeout(function(){t.expandedItem==e&&(i.style.height=i.childNodes.length*24+"px",i.style.padding="5px 10px")},0),util.addClassName(i.parentNode,"selected"),this.expandedItem=e}},s.prototype._onKeyDown=function(e){e=e||window.event;var t=e.target||e.srcElement,n=e.which||e.keyCode,r=!1,i,s,o,u;n==27?(this.selection&&util.setSelection(this.selection),this.anchor&&this.anchor.focus(),this.hide(),r=!0):n==9?e.shiftKey?(i=this._getVisibleButtons(),s=i.indexOf(t),s==0&&(i[i.length-1].focus(),r=!0)):(i=this._getVisibleButtons(),s=i.indexOf(t),s==i.length-1&&(i[0].focus(),r=!0)):n==37?(t.className=="expand"&&(i=this._getVisibleButtons(),s=i.indexOf(t),o=i[s-1],o&&o.focus()),r=!0):n==38?(i=this._getVisibleButtons(),s=i.indexOf(t),o=i[s-1],o&&o.className=="expand"&&(o=i[s-2]),o||(o=i[i.length-1]),o&&o.focus(),r=!0):n==39?(i=this._getVisibleButtons(),s=i.indexOf(t),u=i[s+1],u&&u.className=="expand"&&u.focus(),r=!0):n==40&&(i=this._getVisibleButtons(),s=i.indexOf(t),u=i[s+1],u&&u.className=="expand"&&(u=i[s+2]),u||(u=i[0]),u&&(u.focus(),r=!0),r=!0),r&&(util.stopPropagation(e),util.preventDefault(e))},s.prototype._isChildOf=function(e,t){var n=e.parentNode;while(n){if(n==t)return!0;n=n.parentNode}return!1},o.prototype.onChange=function(){},o.prototype.add=function(e,t){this.index++,this.history[this.index]={action:e,params:t,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()},o.prototype.clear=function(){this.history=[],this.index=-1,this.onChange()},o.prototype.canUndo=function(){return this.index>=0},o.prototype.canRedo=function(){return this.index<this.history.length-1},o.prototype.undo=function(){if(this.canUndo()){var e=this.history[this.index];if(e){var t=this.actions[e.action];t&&t.undo?(t.undo(e.params),e.params.oldSelection&&this.editor.setSelection(e.params.oldSelection)):util.log('Error: unknown action "'+e.action+'"')}this.index--,this.onChange()}},o.prototype.redo=function(){if(this.canRedo()){this.index++;var e=this.history[this.index];if(e){var t=this.actions[e.action];t&&t.redo?(t.redo(e.params),e.params.newSelection&&this.editor.setSelection(e.params.newSelection)):util.log('Error: unknown action "'+e.action+'"')}this.onChange()}},u.prototype.next=function(e){if(this.results!=undefined){var t=this.resultIndex!=undefined?this.resultIndex+1:0;t>this.results.length-1&&(t=0),this._setActiveResult(t,e)}},u.prototype.previous=function(e){if(this.results!=undefined){var t=this.results.length-1,n=this.resultIndex!=undefined?this.resultIndex-1:t;n<0&&(n=t),this._setActiveResult(n,e)}},u.prototype._setActiveResult=function(e,t){if(this.activeResult){var n=this.activeResult.node,r=this.activeResult.elem;r=="field"?delete n.searchFieldActive:delete n.searchValueActive,n.updateDom()}if(!this.results||!this.results[e]){this.resultIndex=undefined,this.activeResult=undefined;return}this.resultIndex=e;var i=this.results[this.resultIndex].node,s=this.results[this.resultIndex].elem;s=="field"?i.searchFieldActive=!0:i.searchValueActive=!0,this.activeResult=this.results[this.resultIndex],i.updateDom(),i.scrollTo(function(){t&&i.focus(s)})},u.prototype._clearDelay=function(){this.timeout!=undefined&&(clearTimeout(this.timeout),delete this.timeout)},u.prototype._onDelayedSearch=function(e){this._clearDelay();var t=this;this.timeout=setTimeout(function(e){t._onSearch(e)},this.delay)},u.prototype._onSearch=function(e,t){this._clearDelay();var n=this.dom.search.value,r=n.length>0?n:undefined;if(r!=this.lastText||t){this.lastText=r,this.results=this.editor.search(r),this._setActiveResult(undefined);if(r!=undefined){var i=this.results.length;switch(i){case 0:this.dom.results.innerHTML="no&nbsp;results";break;case 1:this.dom.results.innerHTML="1&nbsp;result";break;default:this.dom.results.innerHTML=i+"&nbsp;results"}}else this.dom.results.innerHTML=""}},u.prototype._onKeyDown=function(e){e=e||window.event;var t=e.which||e.keyCode;t==27?(this.dom.search.value="",this._onSearch(e),util.preventDefault(e),util.stopPropagation(e)):t==13&&(e.ctrlKey?this._onSearch(e,!0):e.shiftKey?this.previous():this.next(),util.preventDefault(e),util.stopPropagation(e))},u.prototype._onKeyUp=function(e){e=e||window.event;var t=e.which||e.keyCode;t!=27&&t!=13&&this._onDelayedSearch(e)},a.prototype.highlight=function(e){if(this.locked)return;this.node!=e&&(this.node&&this.node.setHighlight(!1),this.node=e,this.node.setHighlight(!0)),this._cancelUnhighlight()},a.prototype.unhighlight=function(){if(this.locked)return;var e=this;this.node&&(this._cancelUnhighlight(),this.unhighlightTimer=setTimeout(function(){e.node.setHighlight(!1),e.node=undefined,e.unhighlightTimer=undefined},0))},a.prototype._cancelUnhighlight=function(){this.unhighlightTimer&&(clearTimeout(this.unhighlightTimer),this.unhighlightTimer=undefined)},a.prototype.lock=function(){this.locked=!0},a.prototype.unlock=function(){this.locked=!1},util={},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t||this,this[n],n,this)}),util.parse=function(e){try{return JSON.parse(e)}catch(t){throw util.validate(e),t}},util.validate=function(e){typeof jsonlint!="undefined"?jsonlint.parse(e):JSON.parse(e)},util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},util.clear=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t];return e},util.log=function(e){console&&typeof console.log=="function"&&console.log.apply(console,arguments)};var f=/^https?:\/\/\S+$/;util.isUrl=function(e){return(typeof e=="string"||e instanceof String)&&f.test(e)},util.getAbsoluteLeft=function(e){var t=e.offsetLeft,n=document.body,r=e.offsetParent;while(r!=null&&e!=n)t+=r.offsetLeft,t-=r.scrollLeft,r=r.offsetParent;return t},util.getAbsoluteTop=function(e){var t=e.offsetTop,n=document.body,r=e.offsetParent;while(r!=null&&r!=n)t+=r.offsetTop,t-=r.scrollTop,r=r.offsetParent;return t},util.getMouseY=function(e){var t;return"pageY"in e?t=e.pageY:t=e.clientY+document.documentElement.scrollTop,t},util.getMouseX=function(e){var t;return"pageX"in e?t=e.pageX:t=e.clientX+document.documentElement.scrollLeft,t},util.getWindowHeight=function(){return"innerHeight"in window?window.innerHeight:Math.max(document.body.clientHeight,document.documentElement.clientHeight)},util.addClassName=function(e,t){var n=e.className.split(" ");n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" "))},util.removeClassName=function(e,t){var n=e.className.split(" "),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))},util.stripFormatting=function(e){var t=e.childNodes;for(var n=0,r=t.length;n<r;n++){var i=t[n];i.style&&i.removeAttribute("style");var s=i.attributes;if(s)for(var o=s.length-1;o>=0;o--){var u=s[o];u.specified==1&&i.removeAttribute(u.name)}util.stripFormatting(i)}},util.setEndOfContentEditable=function(e){var t,n;document.createRange?(t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),n=window.getSelection(),n.removeAllRanges(),n.addRange(t)):document.selection&&(t=document.body.createTextRange(),t.moveToElementText(e),t.collapse(!1),t.select())},util.selectContentEditable=function(e){if(!e||e.nodeName!="DIV")return;var t,n;window.getSelection&&document.createRange?(n=document.createRange(),n.selectNodeContents(e),t=window.getSelection(),t.removeAllRanges(),t.addRange(n)):document.body.createTextRange&&(n=document.body.createTextRange(),n.moveToElementText(e),n.select())},util.getSelection=function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},util.setSelection=function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},util.getSelectionOffset=function(){var e=util.getSelection();return e&&"startOffset"in e&&"endOffset"in e&&e.startContainer&&e.startContainer==e.endContainer?{startOffset:e.startOffset,endOffset:e.endOffset,container:e.startContainer.parentNode}:null},util.setSelectionOffset=function(e){if(document.createRange&&window.getSelection){var t=window.getSelection();if(t){var n=document.createRange();n.setStart(e.container.firstChild,e.startOffset),n.setEnd(e.container.firstChild,e.endOffset),util.setSelection(n)}}},util.getInnerText=function(e,t){var n=t==undefined;n&&(t={text:"",flush:function(){var e=this.text;return this.text="",e},set:function(e){this.text=e}});if(e.nodeValue)return t.flush()+e.nodeValue;if(e.hasChildNodes()){var r=e.childNodes,i="";for(var s=0,o=r.length;s<o;s++){var u=r[s];if(u.nodeName=="DIV"||u.nodeName=="P"){var a=r[s-1],f=a?a.nodeName:undefined;f&&f!="DIV"&&f!="P"&&f!="BR"&&(i+="\n",t.flush()),i+=util.getInnerText(u,t),t.set("\n")}else u.nodeName=="BR"?(i+=t.flush(),t.set("\n")):i+=util.getInnerText(u,t)}return i}return e.nodeName=="P"&&util.getInternetExplorerVersion()!=-1?t.flush():""},util.getInternetExplorerVersion=function(){if(l==-1){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}l=e}return l};var l=-1;util.addEventListener=function(e,t,n,r){if(e.addEventListener)return r===undefined&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,n,r),n;var i=function(){return n.call(e,window.event)};return e.attachEvent("on"+t,i),i},util.removeEventListener=function(e,t,n,r){e.removeEventListener?(r===undefined&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,n,r)):e.detachEvent("on"+t,n)},util.stopPropagation=function(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},util.preventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1};var c={JSONEditor:e,JSONFormatter:function(){throw new Error('JSONFormatter is deprecated. Use JSONEditor with mode "text" or "code" instead')},util:util},h=function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src.split("?")[0],n=t.substring(0,t.length-2)+"css";n="/js/libs/jsoneditor/jsoneditor.css";var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=n,document.getElementsByTagName("head")[0].appendChild(r)};typeof module!="undefined"&&typeof exports!="undefined"&&(h(),module.exports=exports=c),typeof require!="undefined"&&typeof define!="undefined"?define("jsoneditor",[],function(){return h(),c}):window.jsoneditor=c}(),define("backbone-forms",["jquery","Backbone"],function(){var e=function(){return Backbone.View.extend({fields:null,initialize:function(e){this.schema=function(){if(e.schema)return e.schema;var t=e.model;if(!t)throw new Error("Could not find schema");return _.isFunction(t.schema)?t.schema():t.schema}(),this.model=e.model,this.data=e.data,this.fieldsToRender=e.fields||_.keys(this.schema),this.fieldsets=e.fieldsets,this.templateName=e.template||"form",this.fields={}},render:function(){var t=this,n=this.fieldsets,r=e.templates,i=$(r[this.templateName]({fieldsets:'<div class="bbf-placeholder"></div>'})),s=$(".bbf-placeholder",i);return n||(n=[{fields:this.fieldsToRender}]),_.each(n,function(e){_(e).isArray()&&(e={fields:e});var n=$(r.fieldset(_.extend({},e,{legend:e.legend?"<legend>"+e.legend+"</legend>":"",fields:'<div class="bbf-placeholder"></div>'}))),i=$(".bbf-placeholder",n);t.renderFields(e.fields,i),i=i.children().unwrap(),s.append(n)}),s.children().unwrap(),this.setElement(i),this},renderFields:function(t,n){var r=this,i=this.schema,s=this.model,o=this.data,u=this.fields,a=e.helpers.getNested;_.each(t,function(t){var f=function(){if(i[t])return i[t];var e=t.replace(/\./g,".subSchema.");return a(i,e)}();if(!f)throw"Field '"+t+"' not found in schema";var l={form:r,key:t,schema:f,idPrefix:r.options.idPrefix};s?l.model=s:o?l.value=o[t]:l.value=null;var c=new e.Field(l);f.type=="Hidden"?c.editor=helpers.createEditor("Hidden",l):n.append(c.render().el),u[t]=c})},validate:function(){var e=this,t=this.fields,n=this.model,r={};_.each(t,function(e){var t=e.validate();t&&(r[e.key]=t)});if(n&&n.validate){var i=n.validate(this.getValue());if(i){var s=_.isObject(i)&&!_.isArray(i);s||(r._others=r._others||[],r._others.push(i)),s&&_.each(i,function(t,n){if(e.fields[n]&&!r[n])e.fields[n].setError(t);else{r._others=r._others||[];var i={};i[n]=t,r._others.push(i)}})}}return _.isEmpty(r)?null:r},commit:function(){var e=this.validate();if(e)return e;var t;this.model.set(this.getValue(),{error:function(e,n){t=n}});if(t)return t},getValue:function(e){if(e)return this.fields[e].getValue();var t={};return _.each(this.fields,function(e){t[e.key]=e.getValue()}),t},setValue:function(e){for(var t in e)this.fields[t].setValue(e[t])},remove:function(){var e=this.fields;for(var t in e)e[t].remove();Backbone.View.prototype.remove.call(this)}})}(),t={form:'      <form class="bbf-form">{{fieldsets}}</form>    ',fieldset:"      <fieldset>        {{legend}}        <ul>{{fields}}</ul>      </fieldset>    ",field:'    <li class="bbf-field bbf-field{{type}}">      <label for="{{id}}">{{title}}</label>      <div class="bbf-editor bbf-editor{{type}}">{{editor}}</div>      <div class="bbf-help">{{help}}</div>    </li>    '},n={error:"bbf-error"};return e.helpers=function(){var t={};return t.getNested=function(e,t){var n=t.split("."),r=e;for(var i=0,s=n.length;i<s;i++)r=r[n[i]];return r},t.keyToTitle=function(e){return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()}),e},t.compileTemplate=function(e){var t=_.templateSettings.interpolate;_.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var n=_.template(e);return _.templateSettings.interpolate=t,n},t.createTemplate=function(e,n){var r=t.compileTemplate(e);return n?r(n):r},t.setTemplateCompiler=function(e){t.compileTemplate=e},t.setTemplates=function(n,r){var i=t.createTemplate;e.templates=e.templates||{},e.classNames=e.classNames||{},_.each(n,function(t,n,r){_.isString(t)&&(t=i(t)),e.templates[n]=t}),_.extend(e.classNames,r)},t.createEditor=function(t,n){var r;return _.isString(t)?r=e.editors[t]:r=t,new r(n)},t.triggerCancellableEvent=function(e,t,n,r){if(!e._callbacks||!e._callbacks[t])return r();var i=e._callbacks[t].next;if(!i)return r();var s=i.callback,o=i.context||this;n.push(r),s.apply(o,n)},t.getValidator=function(t){var n=e.validators;if(_.isRegExp(t))return n.regexp({regexp:t});if(_.isString(t)){if(!n[t])throw new Error('Validator "'+t+'" not found');return n[t]()}if(_.isFunction(t))return t;if(_.isObject(t)&&t.type){var r=t;return n[r.type](r)}throw new Error("Invalid validator: "+t)},t}(),e.validators=function(){var t={};return t.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:'Must match field "{{field}}"'},t.required=function(t){return t=_.extend({type:"required",message:this.errMessages.required},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return i}},t.regexp=function(t){if(!t.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return t=_.extend({type:"regexp",message:this.errMessages.regexp},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(!t.regexp.test(r))return i}},t.email=function(e){return e=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},e),t.regexp(e)},t.url=function(e){return e=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i},e),t.regexp(e)},t.match=function(t){if(!t.field)throw new Error('Missing required "field" options for "match" validator');return t=_.extend({type:"match",message:this.errMessages.match},t),function(r,i){t.value=r;var s={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(r!=i[t.field])return s}},t}(),e.Field=function(){var t=e.helpers,n=e.templates;return Backbone.View.extend({initialize:function(e){this.form=e.form,this.key=e.key,this.value=e.value,this.model=e.model;var n=this.schema=function(){return _.isString(e.schema)?{type:e.schema}:e.schema||{}}();n.type||(n.type="Text"),n.title||(n.title=t.keyToTitle(this.key)),n.template||(n.template="field")},render:function(){var n=this.schema,r=e.templates,i={form:this.form,key:this.key,schema:n,idPrefix:this.options.idPrefix,id:this.getId()};this.model?i.model=this.model:i.value=this.value;var s=this.editor=t.createEditor(n.type,i),o=$(r[n.template]({key:this.key,title:n.title,id:s.id,type:n.type,editor:'<span class="bbf-placeholder-editor"></span>',help:'<span class="bbf-placeholder-help"></span>'})),u=$(".bbf-placeholder-editor",o);return u.append(s.render().el),u.children().unwrap(),this.$help=$(".bbf-placeholder-help",o).parent(),this.$help.empty(),this.schema.help&&this.$help.html(this.schema.help),this.schema.fieldClass&&o.addClass(this.schema.fieldClass),this.schema.fieldAttrs&&o.attr(this.schema.fieldAttrs),this.setElement(o),this},getId:function(){var e=this.options.idPrefix,t=this.key;return t=t.replace(/\./g,"_"),_.isString(e)||_.isNumber(e)?e+t:_.isNull(e)?t:this.model?this.model.cid+"_"+t:t},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(t){if(this.editor.hasNestedForm)return;var n=e.classNames.error;this.$el.addClass(n),this.$help&&this.$help.html(t)},clearError:function(){var t=e.classNames.error;this.$el.removeClass(t);if(this.$help){this.$help.empty();var n=this.schema.help;n&&this.$help.html(n)}},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},logValue:function(){if(!console||!console.log)return;console.log(this.getValue())},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)}})}(),e.editors=function(){var t={};return t.Base=Backbone.View.extend({defaultValue:null,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw"Missing option: 'key'";this.model=e.model,this.key=e.key,this.value=this.model.get(this.key)}else e.value&&(this.value=e.value);this.value===undefined&&(this.value=this.defaultValue),this.form=e.form,this.schema=e.schema||{},this.validators=e.validators||this.schema.validators,this.$el.attr("name",this.getName()),this.schema.editorClass&&this.$el.addClass(this.schema.editorClass),this.schema.editorAttrs&&this.$el.attr(this.schema.editorAttrs)},getValue:function(){throw"Not implemented. Extend and override this method."},setValue:function(){throw"Not implemented. Extend and override this method."},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},commit:function(){var e=this.validate();if(e)return e;this.model.set(this.key,this.getValue(),{error:function(t,n){e=n}});if(e)return e},validate:function(){var t=this.$el,n=null,r=this.getValue(),i=this.form?this.form.getValue():{},s=this.validators,o=e.helpers.getValidator;return s&&_.each(s,function(e){n||(n=o(e)(r,i))}),n}}),t.Text=t.Base.extend({tagName:"input",defaultValue:"",initialize:function(e){t.Base.prototype.initialize.call(this,e);var n=this.schema,r="text";n&&n.editorAttrs&&n.editorAttrs.type&&(r=n.editorAttrs.type),n&&n.dataType&&(r=n.dataType),this.$el.attr("type",r)},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)}}),t.Number=t.Text.extend({defaultValue:0,events:{keypress:"onKeyPress"},initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","number")},onKeyPress:function(e){if(e.charCode==0)return;var t=this.$el.val()+String.fromCharCode(e.charCode),n=/^[0-9]*\.?[0-9]*?$/.test(t);n||e.preventDefault()},getValue:function(){var e=this.$el.val();return e===""?null:parseFloat(e,10)},setValue:function(e){e=e===null?null:parseFloat(e,10),t.Text.prototype.setValue.call(this,e)}}),t.Password=t.Text.extend({initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),t.TextArea=t.Text.extend({tagName:"textarea"}),t.Checkbox=t.Base.extend({defaultValue:!1,tagName:"input",initialize:function(e){t.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.attr("checked")?!0:!1},setValue:function(e){e&&this.$el.attr("checked",!0)}}),t.Hidden=t.Base.extend({defaultValue:"",initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},getValue:function(){return this.value},setValue:function(e){this.value=e}}),t.Select=t.Base.extend({tagName:"select",initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema||!this.schema.options)throw"Missing required 'schema.options'"},render:function(){var e=this.schema.options,t=this;if(e instanceof Backbone.Collection){var n=e;n.length>0?t.renderOptions(e):n.fetch({success:function(n){t.renderOptions(e)}})}else _.isFunction(e)?e(function(e){t.renderOptions(e)}):t.renderOptions(e);return this},renderOptions:function(e){var t=this.$el,n;_.isString(e)?n=e:_.isArray(e)?n=this._arrayToHtml(e):e instanceof Backbone.Collection&&(n=this._collectionToHtml(e)),t.html(n),this.setValue(this.value)},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_arrayToHtml:function(e){var t=[];return _.each(e,function(e){if(_.isObject(e)){var n=e.val?e.val:"";t.push('<option value="'+n+'">'+e.label+"</option>")}else t.push("<option>"+e+"</option>")}),t.join("")}}),t.Radio=t.Select.extend({tagName:"ul",className:"bbf-radio",getValue:function(){return this.$el.find("input[type=radio]:checked").val()},setValue:function(e){this.$el.find("input[type=radio][value="+e+"]").attr("checked",!0)},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="radio" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="radio" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Checkboxes=t.Select.extend({tagName:"ul",className:"bbf-checkboxes",getValue:function(){var e=[];return this.$el.find("input[type=checkbox]:checked").each(function(){e.push($(this).val())}),e},setValue:function(e){var t=this;_.each(e,function(e){t.$el.find('input[type=checkbox][value="'+e+'"]').attr("checked",!0)})},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="checkbox" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="checkbox" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Object=t.Base.extend({hasNestedForm:!0,className:"bbf-object",defaultValue:{},initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema.subSchema)throw"Missing required 'schema.subSchema' option for Object editor"},render:function(){var t=this.$el,n=this.value||{},r=this.key,i=this.schema,s=i.subSchema;return this.form=new e({schema:s,data:n,idPrefix:this.id+"_"}),t.html(this.form.render().el),this},getValue:function(){return this.form.getValue()},setValue:function(e){this.value=e,this.render()},remove:function(){this.form.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){return this.form.validate()}}),t.NestedModel=t.Object.extend({initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!e.schema.model)throw'Missing required "schema.model" option for NestedModel editor'},render:function(){var t=this.value||{},n=this.key,r=this.schema.model,i=r.prototype.schema;return _.isFunction(i)&&(i=i()),this.form=new e({schema:i,model:new r(t),idPrefix:this.id+"_"}),this.$el.html(this.form.render().el),this},commit:function(){var e=this.form.commit();return e?(this.$el.addClass("error"),e):t.Object.prototype.commit.call(this)}}),t}(),e.setTemplates=e.helpers.setTemplates,e.setTemplateCompiler=e.helpers.setTemplateCompiler,e.setTemplates(t,n),e}),define("instance-admin/models/post",["Backbone","backbone-forms"],function(e,t){var n=t.editors.Text.extend({getValue:function(){return this.$el.val()||null}}),r=/^[0-9]{4}(-[0-9]{2}){0,2}$/;return e.Model.extend({urlRoot:"/api/v0.1/posts",schema:{label:{dataType:"Text",validators:["required"]},role:{dataType:"Text"},start_date:{title:"Start date",type:n,validators:[r],editorClass:"edit-date"},end_date:{title:"End date",type:n,validators:[r],editorClass:"edit-date"},area:{type:"Object",subSchema:{id:{},name:{}}}}})}),define("instance-admin/collections/posts",["Backbone","instance-admin/models/post"],function(e,t){var n=e.Collection.extend({url:"/api/v0.1/posts",model:t});return n}),define("instance-admin/models/membership",["Backbone"],function(e){return e.Model.extend({urlRoot:"/api/v0.1/memberships"})}),define("instance-admin/collections/memberships",["Backbone","instance-admin/models/membership"],function(e,t){var n=e.Collection.extend({url:"/api/v0.1/memberships",model:t});return n}),define("instance-admin/models/nested",["Backbone"],function(e){var t=e.Model.extend({nest:function(e,t,n){if(!n[e])return;this[e]?this[e].reset(n[e]):(this[e]=new t(n[e]),this[e].on("add change remove",function(){this.save()},this)),n[e]=this[e]}});return t}),define("instance-admin/models/contact",["Backbone"],function(e){var t=e.Model.extend({schema:{label:{},type:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/contact_type"},value:{dataType:"Text",validators:["required"]},note:{}}});return t}),define("instance-admin/collections/contacts",["Backbone","instance-admin/models/contact"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("instance-admin/models/other_name",["Backbone","backbone-forms"],function(e,t){var n=t.editors.Text.extend({getValue:function(){return this.$el.val()||null}}),r=/^[0-9]{4}(-[0-9]{2}){0,2}$/,i=e.Model.extend({schema:{name:{dataType:"Text",validators:["required"]},start_date:{title:"Start date",type:n,validators:[r],editorClass:"edit-date"},end_date:{title:"End date",type:n,validators:[r],editorClass:"edit-date"},note:{dataType:"Text"}}});return i}),define("instance-admin/collections/other_names",["Backbone","instance-admin/models/other_name"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("instance-admin/models/identifier",["Backbone"],function(e){var t=e.Model.extend({schema:{identifier:{dataType:"Text",validators:["required"]},scheme:{dataType:"Text",autocomplete_source:"/autocomplete/identifier_scheme"}}});return t}),define("instance-admin/collections/identifiers",["Backbone","instance-admin/models/identifier"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("instance-admin/models/link",["Backbone"],function(e){return e.Model.extend({schema:{url:{dataType:"Text",validators:["required"]},note:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/link_note"}}})}),define("instance-admin/collections/links",["Backbone","instance-admin/models/link"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("instance-admin/models/person",["Backbone","instance-admin/models/nested","instance-admin/collections/contacts","instance-admin/collections/other_names","instance-admin/collections/identifiers","instance-admin/collections/links"],function(e,t,n,r,i,s){var o=t.extend({urlRoot:"/api/v0.1/persons",set:function(t,o){return this.nest("links",s,t),this.nest("contact_details",n,t),this.nest("other_names",r,t),this.nest("identifiers",i,t),e.Model.prototype.set.call(this,t,o)},initialize:function(){e.on("in-place-edit",this.inPlaceEdited,this)},inPlaceEdited:function(e){this.save(e)},schema:{name:{dataType:"Text",validators:["required"]},slug:{dataType:"Text",validators:["required"]}}});return o}),define("instance-admin/models/organization",["Backbone","instance-admin/models/nested","instance-admin/collections/contacts","instance-admin/collections/other_names","instance-admin/collections/identifiers","instance-admin/collections/links"],function(e,t,n,r,i,s){return t.extend({urlRoot:"/api/v0.1/organizations",set:function(t,o){return this.nest("links",s,t),this.nest("contact_details",n,t),this.nest("other_names",r,t),this.nest("identifiers",i,t),e.Model.prototype.set.call(this,t,o)},initialize:function(){e.on("in-place-edit",this.inPlaceEdited,this)},inPlaceEdited:function(e){this.save(e)},schema:{name:{dataType:"Text",validators:["required"]},slug:{dataType:"Text",validators:["required"]}}})}),define("jquery.fancybox",["jquery"],function(e){(function(e,t,n,r){var i=n(e),s=n(t),o=n.fancybox=function(){o.open.apply(this,arguments)},u=!1,a=null,f=t.createTouch!==r,l=function(e){return n.type(e)==="string"},c=function(e){return l(e)&&e.indexOf("%")>0},h=function(e,t){return t&&c(e)&&(e=o.getViewport()[t]/100*parseInt(e,10)),Math.round(e)+"px"};n.extend(o,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!f,autoCenter:!f,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!1,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(n.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:300,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:300,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){o.close(!0),e&&!n.isArray(e)&&(e=e instanceof n?n(e).get():[e]),o.isActive=!0,o.opts=n.extend(!0,{},o.defaults,t),n.isPlainObject(t)&&t.keys!==r&&(o.opts.keys=t.keys?n.extend({},o.defaults.keys,t.keys):!1),o.group=e,o._start(o.opts.index||0)},cancel:function(){if(o.coming&&!1===o.trigger("onCancel"))return;o.coming=null,o.hideLoading(),o.ajaxLoad&&o.ajaxLoad.abort(),o.ajaxLoad=null,o.imgPreload&&(o.imgPreload.onload=o.imgPreload.onabort=o.imgPreload.onerror=null)},close:function(e){o.cancel();if(!o.current||!1===o.trigger("beforeClose"))return;o.unbindEvents(),!o.isOpen||e&&e[0]===!0?(n(".fancybox-wrap").stop().trigger("onReset").remove(),o._afterZoomOut()):(o.isOpen=o.isOpened=!1,n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.closeMethod]())},play:function(e){var t=function(){clearTimeout(o.player.timer)},r=function(){t(),o.current&&o.player.isActive&&(o.player.timer=setTimeout(o.next,o.current.playSpeed))},i=function(){t(),n("body").unbind(".player"),o.player.isActive=!1,o.trigger("onPlayEnd")},s=function(){o.current&&(o.current.loop||o.current.index<o.group.length-1)&&(o.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":r,"onCancel.player beforeClose.player":i,"beforeLoad.player":t}),r(),o.trigger("onPlayStart"))};o.player.isActive||e&&e[0]===!1?i():s()},next:function(){o.current&&o.jumpto(o.current.index+1)},prev:function(){o.current&&o.jumpto(o.current.index-1)},jumpto:function(e){if(!o.current)return;e=parseInt(e,10),o.group.length>1&&o.current.loop&&(e>=o.group.length?e=0:e<0&&(e=o.group.length-1)),o.group[e]!==r&&(o.cancel(),o._start(e))},reposition:function(e,t){var n;o.isOpen&&(n=o._getPosition(t),e&&e.type==="scroll"?(delete n.position,o.wrap.stop(!0,!0).animate(n,200)):o.wrap.css(n))},update:function(e){if(!o.isOpen)return;u||(a=setTimeout(function(){var t=o.current,n=!e||e&&e.type==="orientationchange";if(u){u=!1;if(!t)return;if(!e||e.type!=="scroll"||n)t.autoSize&&t.type!=="iframe"&&(o.inner.height("auto"),t.height=o.inner.height()),(t.autoResize||n)&&o._setDimension(),t.canGrow&&t.type!=="iframe"&&o.inner.height("auto");(t.autoCenter||n)&&o.reposition(e),o.trigger("onUpdate")}},200)),u=!0},toggle:function(){o.isOpen&&(o.current.fitToView=!o.current.fitToView,o.update())},hideLoading:function(){s.unbind("keypress.fb"),n("#fancybox-loading").remove()},showLoading:function(){o.hideLoading(),s.bind("keypress.fb",function(e){e.keyCode===27&&(e.preventDefault(),o.cancel())}),n('<div id="fancybox-loading"><div></div></div>').click(o.cancel).appendTo("body")},getViewport:function(){return{x:i.scrollLeft(),y:i.scrollTop(),w:f&&e.innerWidth?e.innerWidth:i.width(),h:f&&e.innerHeight?e.innerHeight:i.height()}},unbindEvents:function(){o.wrap&&o.wrap.unbind(".fb"),s.unbind(".fb"),i.unbind(".fb")},bindEvents:function(){var e=o.current,t=e.keys;if(!e)return;i.bind("resize.fb orientationchange.fb"+(e.autoCenter&&!e.fixed?" scroll.fb":""),o.update),t&&s.bind("keydown.fb",function(e){var r,i=e.target||e.srcElement;!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(!i||!i.type&&!n(i).is("[contenteditable]"))&&(r=e.keyCode,n.inArray(r,t.close)>-1?(o.close(),e.preventDefault()):n.inArray(r,t.next)>-1?(o.next(),e.preventDefault()):n.inArray(r,t.prev)>-1&&(o.prev(),e.preventDefault()))}),n.fn.mousewheel&&e.mouseWheel&&o.group.length>1&&o.wrap.bind("mousewheel.fb",function(e,t){var n=e.target||null;t!==0&&(!n||n.clientHeight===0||n.scrollHeight===n.clientHeight&&n.scrollWidth===n.clientWidth)&&(e.preventDefault(),o[t>0?"prev":"next"]())})},trigger:function(e,t){var r,i=t||o[n.inArray(e,["onCancel","beforeLoad","afterLoad"])>-1?"coming":"current"];if(!i)return;n.isFunction(i[e])&&(r=i[e].apply(i,Array.prototype.slice.call(arguments,1)));if(r===!1)return!1;i.helpers&&n.each(i.helpers,function(t,r){r&&n.isPlainObject(o.helpers[t])&&n.isFunction(o.helpers[t][e])&&o.helpers[t][e](r,i)}),n.event.trigger(e+".fb")},isImage:function(e){return l(e)&&e.match(/\.(jpe?g|gif|png|bmp)((\?|#).*)?$/i)},isSWF:function(e){return l(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t={},r=o.group[e]||null,i,s,u,a,f;r&&(r.nodeType||r instanceof n)&&(i=!0,n.metadata&&(t=n(r).metadata())),t=n.extend(!0,{},o.opts,{index:e,element:r},n.isPlainObject(r)?r:t),n.each(["href","title","content","type"],function(e,s){t[s]=o.opts[s]||i&&n(r).attr(s)||t[s]||null}),typeof t.margin=="number"&&(t.margin=[t.margin,t.margin,t.margin,t.margin]),t.modal&&n.extend(!0,t,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),o.coming=t;if(!1===o.trigger("beforeLoad")){o.coming=null;return}u=t.type,s=t.href||r,u||(i&&(u=n(r).data("fancybox-type"),u||(a=r.className.match(/fancybox\.(\w+)/),u=a?a[1]:null)),!u&&l(s)&&(o.isImage(s)?u="image":o.isSWF(s)?u="swf":s.match(/^#/)&&(u="inline")),u||(u=i?"inline":"html"),t.type=u);if(u==="inline"||u==="html"){t.content||(u==="inline"?t.content=n(l(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):t.content=r);if(!t.content||!t.content.length)u=null}else s||(u=null);u==="ajax"&&l(s)&&(f=s.split(/\s+/,2),s=f.shift(),t.selector=f.shift()),t.href=s,t.group=o.group,t.isDom=i;switch(u){case"image":o._loadImage();break;case"ajax":o._loadAjax();break;case"inline":case"iframe":case"swf":case"html":o._afterLoad();break;default:o._error("type")}},_error:function(e){o.hideLoading(),n.extend(o.coming,{type:"html",autoSize:!0,minWidth:0,minHeight:0,padding:15,hasError:e,content:o.coming.tpl.error}),o._afterLoad()},_loadImage:function(){var e=o.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,o.coming.width=this.width,o.coming.height=this.height,o._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,o._error("image")},e.src=o.coming.href,(e.complete===r||!e.complete)&&o.showLoading()},_loadAjax:function(){o.showLoading(),o.ajaxLoad=n.ajax(n.extend({},o.coming.ajax,{url:o.coming.href,error:function(e,t){o.coming&&t!=="abort"?o._error("ajax",e):o.hideLoading()},success:function(e,t){t==="success"&&(o.coming.content=e,o._afterLoad())}}))},_preloadImages:function(){var e=o.group,t=o.current,r=e.length,i,s,u,a=Math.min(t.preload,r-1);if(!t.preload||e.length<2)return;for(u=1;u<=a;u+=1){i=e[(t.index+u)%r],s=i.href||n(i).attr("href")||i;if(i.type==="image"||o.isImage(s))(new Image).src=s}},_afterLoad:function(){o.hideLoading();if(!o.coming||!1===o.trigger("afterLoad",o.current)){o.coming=!1;return}o.isOpened?(n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.prevMethod]()):(n(".fancybox-wrap").stop().trigger("onReset").remove(),o.trigger("afterClose")),o.unbindEvents(),o.isOpen=!1,o.current=o.coming,o.wrap=n(o.current.tpl.wrap).addClass("fancybox-"+(f?"mobile":"desktop")+" fancybox-type-"+o.current.type+" fancybox-tmp "+o.current.wrapCSS).appendTo("body"),o.skin=n(".fancybox-skin",o.wrap).css("padding",h(o.current.padding)),o.outer=n(".fancybox-outer",o.wrap),o.inner=n(".fancybox-inner",o.wrap),o._setContent()},_setContent:function(){var e=o.current,t=e.content,r=e.type,i=e.minWidth,s=e.minHeight,u=e.maxWidth,a=e.maxHeight,l;switch(r){case"inline":case"ajax":case"html":e.selector?t=n("<div>").html(t).find(e.selector):t instanceof n&&(t.parent().hasClass("fancybox-inner")&&t.parents(".fancybox-wrap").unbind("onReset"),t=t.show().detach(),n(o.wrap).bind("onReset",function(){t.appendTo("body").hide()})),e.autoSize&&(l=n('<div class="fancybox-wrap '+o.current.wrapCSS+' fancybox-tmp"></div>').appendTo("body").css({minWidth:h(i,"w"),minHeight:h(s,"h"),maxWidth:h(u,"w"),maxHeight:h(a,"h")}).append(t),e.width=l.width(),e.height=l.height(),l.width(o.current.width),l.height()>e.height&&(l.width(e.width+1),e.width=l.width(),e.height=l.height()),t=l.contents().detach(),l.remove());break;case"image":t=e.tpl.image.replace("{href}",e.href),e.aspectRatio=!0;break;case"swf":t=e.tpl.swf.replace(/\{width\}/g,e.width).replace(/\{height\}/g,e.height).replace(/\{href\}/g,e.href);break;case"iframe":t=n(e.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",e.scrolling).attr("src",e.href),e.scrolling=f?"scroll":"auto"}if(r==="image"||r==="swf")e.autoSize=!1,e.scrolling="visible";r==="iframe"&&e.autoSize?(o.showLoading(),o._setDimension(),o.inner.css("overflow",e.scrolling),t.bind({onCancel:function(){n(this).unbind(),o._afterZoomOut()},load:function(){o.hideLoading();try{this.contentWindow.document.location&&(o.current.height=n(this).contents().find("body").height())}catch(e){o.current.autoSize=!1}o[o.isOpen?"_afterZoomIn":"_beforeShow"]()}}).appendTo(o.inner)):(o.inner.append(t),o._beforeShow())},_beforeShow:function(){o.coming=null,o.trigger("beforeShow"),o._setDimension(),o.wrap.hide().removeClass("fancybox-tmp"),o.bindEvents(),o._preloadImages(),o.transitions[o.isOpened?o.current.nextMethod:o.current.openMethod]()},_setDimension:function(){var e=o.wrap,t=o.inner,r=o.current,i=o.getViewport(),s=r.margin,u=r.padding*2,a=r.width,f=r.height,l=r.maxWidth+u,p=r.maxHeight+u,d=r.minWidth+u,v=r.minHeight+u,m,g;i.w-=s[1]+s[3],i.h-=s[0]+s[2],c(a)&&(a=(i.w-u)*parseFloat(a)/100),c(f)&&(f=(i.h-u)*parseFloat(f)/100),m=a/f,a+=u,f+=u,r.fitToView&&(l=Math.min(i.w,l),p=Math.min(i.h,p)),r.aspectRatio?(a>l&&(a=l,f=(a-u)/m+u),f>p&&(f=p,a=(f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u),f<v&&(f=v,a=(f-u)*m+u)):(a=Math.max(d,Math.min(a,l)),f=Math.max(v,Math.min(f,p))),a=Math.round(a),f=Math.round(f),n(e.add(t)).width("auto").height("auto"),t.width(a-u).height(f-u),e.width(a),g=e.height();if(a>l||g>p)while((a>l||g>p)&&a>d&&g>v)f-=10,r.aspectRatio?(a=Math.round((f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u)):a-=10,t.width(a-u).height(f-u),e.width(a),g=e.height();r.dim={width:h(a),height:h(g)},r.canGrow=r.autoSize&&f>v&&f<p,r.canShrink=!1,r.canExpand=!1,a-u<r.width||f-u<r.height?r.canExpand=!0:(a>i.w||g>i.h)&&a>d&&f>v&&(r.canShrink=!0),o.innerSpace=g-u-t.height()},_getPosition:function(e){var t=o.current,n=o.getViewport(),r=t.margin,i=o.wrap.width()+r[1]+r[3],s=o.wrap.height()+r[0]+r[2],u={position:"absolute",top:r[0]+n.y,left:r[3]+n.x};return t.autoCenter&&t.fixed&&!e&&s<=n.h&&i<=n.w&&(u={position:"fixed",top:r[0],left:r[3]}),u.top=h(Math.max(u.top,u.top+(n.h-s)*t.topRatio)),u.left=h(Math.max(u.left,u.left+(n.w-i)*.5)),u},_afterZoomIn:function(){var e=o.current,t=e?e.scrolling:"no";if(!e)return;o.isOpen=o.isOpened=!0,o.wrap.addClass("fancybox-opened"),o.inner.css("overflow",t==="yes"?"scroll":t==="no"?"hidden":t),o.trigger("afterShow"),o.update(),(e.closeClick||e.nextClick)&&o.inner.css("cursor","pointer").bind("click.fb",function(t){!n(t.target).is("a")&&!n(t.target).parent().is("a")&&o[e.closeClick?"close":"next"]()}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(o.skin).bind("click.fb",o.close),e.arrows&&o.group.length>1&&((e.loop||e.index>0)&&n(e.tpl.prev).appendTo(o.outer).bind("click.fb",o.prev),(e.loop||e.index<o.group.length-1)&&n(e.tpl.next).appendTo(o.outer).bind("click.fb",o.next)),o.opts.autoPlay&&!o.player.isActive&&(o.opts.autoPlay=!1,o.play())},_afterZoomOut:function(){var e=o.current;o.wrap.trigger("onReset").remove(),n.extend(o,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,skin:null,outer:null,inner:null}),o.trigger("afterClose",e)}}),o.transitions={getOrigPosition:function(){var e=o.current,t=e.element,r=e.padding,i=n(e.orig),s={},u=50,a=50,f;return!i.length&&e.isDom&&n(t).is(":visible")&&(i=n(t).find("img:first"),i.length||(i=n(t))),i.length?(s=i.offset(),i.is("img")&&(u=i.outerWidth(),a=i.outerHeight())):(f=o.getViewport(),s.top=f.y+(f.h-a)*.5,s.left=f.x+(f.w-u)*.5),s={top:h(s.top-r),left:h(s.left-r),width:h(u+r*2),height:h(a+r*2)},s},step:function(e,t){var n=t.prop,r,i;if(n==="width"||n==="height")r=Math.ceil(e-o.current.padding*2),n==="height"&&(i=(e-t.start)/(t.end-t.start),t.start>t.end&&(i=1-i),r-=o.innerSpace*i),o.inner[n](r)},zoomIn:function(){var e=o.wrap,t=o.current,r=t.openEffect,i=r==="elastic",s=t.dim,u=n.extend({},s,o._getPosition(i)),a=n.extend({opacity:1},u);delete a.position,i?(u=this.getOrigPosition(),t.openOpacity&&(u.opacity=0),o.outer.add(o.inner).width("auto").height("auto")):r==="fade"&&(u.opacity=0),e.css(u).show().animate(a,{duration:r==="none"?0:t.openSpeed,easing:t.openEasing,step:i?this.step:null,complete:o._afterZoomIn})},zoomOut:function(){var e=o.wrap,t=o.current,n=t.openEffect,r=n==="elastic",i={opacity:0};r&&(e.css("position")==="fixed"&&e.css(o._getPosition(!0)),i=this.getOrigPosition(),t.closeOpacity&&(i.opacity=0)),e.animate(i,{duration:n==="none"?0:t.closeSpeed,easing:t.closeEasing,step:r?this.step:null,complete:o._afterZoomOut})},changeIn:function(){var e=o.wrap,t=o.current,n=t.nextEffect,r=n==="elastic",i=o._getPosition(r),s={opacity:1};i.opacity=0,r&&(i.top=h(parseInt(i.top,10)-200),s.top="+=200px"),e.css(i).show().animate(s,{duration:n==="none"?0:t.nextSpeed,easing:t.nextEasing,complete:o._afterZoomIn})},changeOut:function(){var e=o.wrap,t=o.current,r=t.prevEffect,i={opacity:0},s=function(){n(this).trigger("onReset").remove()};e.removeClass("fancybox-opened"),r==="elastic"&&(i.top="+=200px"),e.animate(i,{duration:r==="none"?0:t.prevSpeed,easing:t.prevEasing,complete:s})}},o.helpers.overlay={overlay:null,update:function(){var e,r,o;this.overlay.width("100%").height("100%"),n.browser.msie||f?(r=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth),o=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),e=r<o?i.width():r):e=s.width(),this.overlay.width(e).height(s.height())},beforeShow:function(e){if(this.overlay)return;e=n.extend(!0,{},o.defaults.helpers.overlay,e),this.overlay=n('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),e.closeClick&&this.overlay.bind("click.fb",o.close),o.current.fixed&&!f?this.overlay.addClass("overlay-fixed"):(this.update(),this.onUpdate=function(){this.update()}),this.overlay.fadeTo(e.speedIn,e.opacity)},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,function(){n(this).remove()}),this.overlay=null}},o.helpers.title={beforeShow:function(e){var t,r=o.current.title;r&&(t=n('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+r+"</div>").appendTo("body"),e.type==="float"&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),o.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo(e.type==="over"?o.inner:e.type==="outside"?o.wrap:o.skin))}},n.fn.fancybox=function(e){var t=n(this),r=this.selector||"",i,u=function(s){var u=this,a=i,f,l;!(s.ctrlKey||s.altKey||s.shiftKey||s.metaKey)&&!n(u).is(".fancybox-wrap")&&(s.preventDefault(),f=e.groupAttr||"data-fancybox-group",l=n(u).attr(f),l||(f="rel",l=u[f]),l&&l!==""&&l!=="nofollow"&&(u=r.length?n(r):t,u=u.filter("["+f+'="'+l+'"]'),a=u.index(this)),e.index=a,o.open(u,e))};return e=e||{},i=e.index||0,r?s.undelegate(r,"click.fb-start").delegate(r,"click.fb-start",u):t.unbind("click.fb-start").bind("click.fb-start",u),this},n(t).ready(function(){o.defaults.fixed=n.support.fixedPosition||!(n.browser.msie&&n.browser.version<=6)&&!f})})(window,document,e)}),define("instance-admin/app",["jquery","Backbone","jsoneditor","instance-admin/collections/posts","instance-admin/collections/memberships","instance-admin/models/person","instance-admin/models/organization","jquery.fancybox"],function(e,t,n,r,i,s,o){function u(t){popit.model[t].on("reset",function(){e("section."+t+" li").each(function(n,r){var i=popit.model[t].at(n);if(!i)return;e.data(r,"id",i.cid)})}),popit.model[t].trigger("reset")}e.fancybox.defaults.openSpeed=100,e.fancybox.defaults.closeSpeed=100,e.fancybox.defaults.helpers.overlay.speedIn=100,e.fancybox.defaults.helpers.overlay.speedOut=100,e(function(){if(typeof popit=="undefined")return;popit.data&&popit.data._id&&(popit.data.id=popit.data._id,delete popit.data._id),popit.posts&&e.each(popit.posts,function(e,t){t.id=t._id,delete t._id}),popit.memberships&&(popit.memberships=e.map(popit.memberships,function(e){return{id:e}})),popit.type=="person"?(popit.model=new s(popit.data),u("links"),u("contact_details"),u("other_names"),u("identifiers"),popit.model.memberships=new i(popit.memberships),u("memberships")):popit.type=="organization"&&(popit.model=new o(popit.data),u("links"),u("contact_details"),u("other_names"),u("identifiers"),popit.model.posts=new r(popit.posts),u("posts"),popit.model.memberships=new i(popit.memberships),u("memberships"));var a=e("#jsoneditor");if(a.length){var f=new n.JSONEditor(a[0],{change:function(){var e=f.get();t.trigger("in-place-edit",e)}});f.set(JSON.parse(JSON.stringify(popit.data)))}e("body").on("focus","input.edit-date, .edit-date input",function(){e(this).attr("pattern","^[0-9]{4}(-[0-9]{2}){0,2}$"),e(this).attr("title","Please enter YYYY-MM-DD, YYYY-MM or just YYYY.")})})}),define("instance-admin/views/remove-modal",["Backbone","underscore"],function(e,t){var n=e.View.extend({initialize:function(e){this.template=t.template(e.template)},render:function(e){return e=t.extend({},e),this.model&&(e.item=this.model.toJSON()),this.$el.html(this.template(e)),this}});return n}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f;return a={version:"1.0.8",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}return t},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText)n();else{var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})}},write:function(e,t,n){if(u.hasOwnProperty(t)){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}},a.createXhr()?a.get=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(f=require.nodeRequire("fs"),a.get=function(e,t){var n=f.readFileSync(e,"utf8");n.indexOf("﻿")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(a.get=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a})}(),define("text!templates/photo-remove.html",[],function(){return'<div>\n  <form action="<%- image_url %>/delete" method="post">\n    <input type=\'submit\' value="Really delete photo?">\n  </form>\n</div>\n'}),define("instance-admin/actions/photo-remove",["jquery","instance-admin/views/remove-modal","text!templates/photo-remove.html","jquery.fancybox"],function(e,t,n){e(function(){e(".delete-photo").click(function(r){r.preventDefault();var i=e(this),s=new t({template:n});e.fancybox(s.render({image_url:i.attr("data-image-url")}).el)})})}),define("text!templates/person/new.html",[],function(){return'<div id="new-person">\n  <h1>Add a person</h1>\n  \n  <form name="create-new-person">\n\n    <% // more content inserted in the bb view %>\n\n    <h2>Suggestions</h2>\n\n    <ul class="suggestions" />\n    \n    <input type=\'submit\' value="Create new person">\n  </form>\n</div>\n'}),define("instance-admin/views/submit-form-helper",["jquery","underscore"],function(e,t){return function(n){return n=n||{},function(r){r.preventDefault();var i=n.view||this,s=i.form,o=n.success_cb||function(e,t){document.location="/"+n.type+"/"+t.slug},u=function(n,r){var i=r.responseText;if(!i)return;var o=e.parseJSON(r.responseText).errors||{};t.each(o,function(e,t){s.fields[t]&&s.fields[t].setError(e)})},a=s.commit();t.isEmpty(a)&&(n.pre_save_cb&&n.pre_save_cb(),i.model.save({},{success:o,error:u}))}}}),define("instance-admin/collections/suggestions",["Backbone"],function(e){var t=e.Collection.extend({});return t}),define("text!templates/suggestions/compact_list.html",[],function(){return'<% if (items.length) { %>\n  <% _.each( items, function ( item ) { %>\n    <li>\n      <a href="/<%- url_type %>/<%- item.slug %>"><%- item.name %> (<%- item.slug %>)</a>\n    </li>\n  <% }); %>\n<% } else { %>\n  <li>No matches</li>\n<% } %>\n'}),define("instance-admin/views/suggestions",["Backbone","underscore","instance-admin/collections/suggestions","text!templates/suggestions/compact_list.html"],function(e,t,n,r){var i=e.View.extend({tagName:"ul",className:"suggestions",collection:new n,listTemplate:t.template(r),render:function(){var e=this.listTemplate({url_type:this.options.url_type,items:this.collection.toJSON()});return this.$el.html(e),this},setName:t.debounce(function(e){var t=this;return e?t.collection.fetch({data:{name:e},success:function(){t.render()}}):(t.collection.reset(),t.render()),t},200)});return i}),define("instance-admin/views/person-new",["jquery","Backbone","backbone-forms","underscore","utils/slugify","text!templates/person/new.html","instance-admin/models/person","instance-admin/views/submit-form-helper","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u,a){var f=t.View.extend({personTemplate:r.template(s),initialize:function(){this.form=new n({model:this.model,fields:["name","slug"]}),this.suggestionsView=new a({url_type:"persons"}),this.suggestionsView.collection.url="/autocomplete/persons"},render:function(){var t=e(this.personTemplate()),n=e(this.form.render().el);return t.find("form").prepend(n.children()),this.$el.html(t),this.$("ul.suggestions").html(this.suggestionsView.render().el),this},events:{"submit form ":"submitForm","keyup input[name=name]":"nameEdit"},submitForm:u({type:"persons"}),nameEdit:function(e){var t=this.$(":input[name=name]"),n=this.$(":input[name=slug]");n.val(i(t.val()));var r=this;return r.suggestionsView.setName(t.val()),!0}});return f}),define("instance-admin/views/remove-model",["instance-admin/views/remove-modal","underscore"],function(e,t){var n=e.extend({initialize:function(n){e.prototype.initialize.apply(this,arguments),this.submitSuccess=n.submitSuccess,t.bindAll(this,"submitSuccess")},events:{"submit form":"submitForm"},submitForm:function(e){e.preventDefault(),this.model.destroy({success:this.submitSuccess,error:function(e,t){window.alert("Something went wrong with the delete - please try again")}})}});return n}),define("text!templates/person/remove.html",[],function(){return'<div id="remove-person">\n  <form name="remove-person" method="post">\n    <input type=\'submit\' value="Really delete \'<%- item.name %>\'?">\n  </form>\n</div>\n'}),define("instance-admin/actions/person-add-remove",["jquery","instance-admin/models/person","instance-admin/views/person-new","instance-admin/views/remove-model","text!templates/person/remove.html","jquery.fancybox"],function(e,t,n,r,i){e(function(){e("a.new-person").click(function(r){r.preventDefault();var i=new t({}),s=new n({model:i});e.fancybox(s.render().el),s.$(":input:first").focus()}),e("a.delete-person").click(function(t){t.preventDefault();var n=e(this),s=new r({model:popit.model,template:i,submitSuccess:function(e,t){document.location="/persons"}});e.fancybox(s.render().el)})})}),define("text!templates/organization/new.html",[],function(){return'<div id="new-organization">\n  <h1>Add a organization</h1>\n  \n  <form name="create-new-organization">\n\n    <% // more content inserted in the bb view %>\n\n    <h2>Suggestions</h2>\n\n    <ul class="suggestions" />\n    \n    <input type=\'submit\' value="Create new organization">\n  </form>\n</div>\n'}),define("instance-admin/views/organization-new",["jquery","Backbone","backbone-forms","underscore","utils/slugify","text!templates/organization/new.html","instance-admin/models/organization","instance-admin/views/submit-form-helper","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u,a){var f=t.View.extend({orgTemplate:r.template(s),initialize:function(){this.form=new n({model:this.model,fields:["name","slug"]}),this.suggestionsView=new a({url_type:"organizations"}),this.suggestionsView.collection.url="/autocomplete/organizations"},render:function(){var t=e(this.orgTemplate()),n=e(this.form.render().el);return t.find("form").prepend(n.children()),this.$el.html(t),this.$("ul.suggestions").html(this.suggestionsView.render().el),this},events:{"submit form ":"submitForm","keyup input[name=name]":"nameEdit"},submitForm:u({type:"organizations"}),nameEdit:function(e){var t=this.$(":input[name=name]"),n=this.$(":input[name=slug]");n.val(i(t.val()));var r=this;return r.suggestionsView.setName(t.val()),!0}});return f}),define("text!templates/organization/remove.html",[],function(){return'<div id="remove-organization">\n  <form name="remove-organization" method="post">\n    <input type=\'submit\' value="Really delete \'<%- item.name %>\'?">\n  </form>\n</div>\n'}),define("instance-admin/actions/organization-add-remove",["jquery","instance-admin/models/organization","instance-admin/views/organization-new","instance-admin/views/remove-model","text!templates/organization/remove.html","jquery.fancybox"],function(e,t,n,r,i){e(function(){e("a.new-organization").click(function(r){r.preventDefault();var i=new t({}),s=new n({model:i});e.fancybox(s.render().el),s.$(":input:first").focus()}),e("a.delete-organization").click(function(t){t.preventDefault();var n=e(this),s=new r({model:popit.model,template:i,submitSuccess:function(e,t){document.location="/organizations"}});e.fancybox(s.render().el)})})}),define("text!templates/membership/new.html",[],function(){return'<div id="new-membership">\n\n  <h2>Edit membership</h2>\n\n  <form name="edit-membership">\n\n    <ul class="error" />\n\n    <p class="post">\n      <label>Post</label>\n      <input name="post_id" style="width:100%;" />\n    </p>\n\n    <p class="label">\n      <label>Label</label>\n      <input name="label" style="width:100%;" />\n    </p>\n\n    <p class="role">\n      <label>Role</label>\n      <input name="role" style="width:100%;" />\n    </p>\n\n    <p class="person">\n      <label>Person</label>\n      <input name="person_id" style="width:100%;" />\n    </p>\n\n    <p class="organization">\n      <label>Organization</label>\n      <input name="organization_id" style="width:100%;" />\n    </p>\n\n    <div style="float: left; width: 50%;">\n    <p class="start_date edit-date">\n      <label>Start date</label>\n      <input name="start_date" style="width:10em;" />\n    </p>\n    </div>\n\n    <div style="float: left; width: 50%;">\n    <p class="end_date edit-date">\n      <label>End date</label>\n      <input name="end_date" style="width:10em;" />\n    </p>\n    </div>\n\n    <p class="area">\n      <label>Area ID</label>\n      <input name="area_id" style="width:100%;">\n      <label>Area name</label>\n      <input name="area_name" style="width:100%;">\n    </p>\n\n    <p>\n      <input type=\'submit\' value="Save membership" />\n    </p>\n  </form>\n</div>\n'}),define("jquery.select2",["jquery"],function(e){return function(e){typeof e.fn.each2=="undefined"&&e.fn.extend({each2:function(t){var n=e([0]),r=-1,i=this.length;while(++r<i&&(n.context=n[0]=this[r])&&t.call(n[0],r,n)!==!1);return this}})}(e),function(e,t){function a(e,t){var n=0,r=t.length,i;if(typeof e=="undefined")return-1;if(e.constructor===String){for(;n<r;n+=1)if(e.localeCompare(t[n])===0)return n}else for(;n<r;n+=1){i=t[n];if(i.constructor===String){if(i.localeCompare(e)===0)return n}else if(i===e)return n}return-1}function f(e,n){return e===n?!0:e===t||n===t?!1:e===null||n===null?!1:e.constructor===String?e.localeCompare(n)===0:n.constructor===String?n.localeCompare(e)===0:!1}function l(t,n){var r,i,s;if(t===null||t.length<1)return[];r=t.split(n);for(i=0,s=r.length;i<s;i+=1)r[i]=e.trim(r[i]);return r}function c(e){return e.outerWidth()-e.width()}function h(n){var r="keyup-change-value";n.bind("keydown",function(){e.data(n,r)===t&&e.data(n,r,n.val())}),n.bind("keyup",function(){var i=e.data(n,r);i!==t&&n.val()!==i&&(e.removeData(n,r),n.trigger("keyup-change"))})}function p(n){n.bind("mousemove",function(n){var r=e.data(document,"select2-lastpos");(r===t||r.x!==n.pageX||r.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function d(e,n,r){r=r||t;var i;return function(){var t=arguments;window.clearTimeout(i),i=window.setTimeout(function(){n.apply(r,t)},e)}}function v(e){var t=!1,n;return function(){return t===!1&&(n=e(),t=!0),n}}function m(e,t){var n=d(e,function(e){t.trigger("scroll-debounced",e)});t.bind("scroll",function(e){a(e.target,t.get())>=0&&n(e)})}function g(e){e.preventDefault(),e.stopPropagation()}function y(t){if(!u){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);u=e("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),e("body").append(u)}return u.text(t.val()),u.width()}function b(e,t,n){var r=e.toUpperCase().indexOf(t.toUpperCase()),i=t.length;if(r<0){n.push(e);return}n.push(e.substring(0,r)),n.push("<span class='select2-match'>"),n.push(e.substring(r,r+i)),n.push("</span>"),n.push(e.substring(r+i,e.length))}function w(t){var n,r=0,i=null,s=t.quietMillis||100;return function(o){window.clearTimeout(n),n=window.setTimeout(function(){r+=1;var n=r,s=t.data,u=t.transport||e.ajax,a=t.traditional||!1,f=t.type||"GET";s=s.call(this,o.term,o.page,o.context),null!==i&&i.abort(),i=u.call(null,{url:t.url,dataType:t.dataType,data:s,type:f,traditional:a,success:function(e){if(n<r)return;var i=t.results(e,o.page);o.callback(i)}})},s)}}function E(t){var n=t,r,i=function(e){return""+e.text};return e.isArray(n)||(i=n.text,e.isFunction(i)||(r=n.text,i=function(e){return e[r]}),n=n.results),function(t){var r=t.term,s={results:[]},o;if(r===""){t.callback({results:n});return}o=function(n,s){var u,a;n=n[0];if(n.children){u={};for(a in n)n.hasOwnProperty(a)&&(u[a]=n[a]);u.children=[],e(n.children).each2(function(e,t){o(t,u.children)}),u.children.length&&s.push(u)}else t.matcher(r,i(n))&&s.push(n)},e(n).each2(function(e,t){o(t,s.results)}),t.callback(s)}}function S(n){return e.isFunction(n)?n:function(r){var i=r.term,s={results:[]};e(n).each(function(){var e=this.text!==t,n=e?this.text:this;(i===""||r.matcher(i,n))&&s.results.push(e?this:{id:this,text:this})}),r.callback(s)}}function x(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error("formatterName must be a function or a falsy value")}function T(t){return e.isFunction(t)?t():t}function N(t){var n=0;return e.each(t,function(e,t){t.children?n+=N(t.children):n++}),n}function C(e,n,r,i){var s=e,o=!1,u,a,l,c,h;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return t;for(;;){a=-1;for(l=0,c=i.tokenSeparators.length;l<c;l++){h=i.tokenSeparators[l],a=e.indexOf(h);if(a>=0)break}if(a<0)break;u=e.substring(0,a),e=e.substring(a+h.length);if(u.length>0){u=i.createSearchChoice(u,n);if(u!==t&&u!==null&&i.id(u)!==t&&i.id(u)!==null){o=!1;for(l=0,c=n.length;l<c;l++)if(f(i.id(u),i.id(n[l]))){o=!0;break}o||r(u)}}}if(s.localeCompare(e)!=0)return e}function k(t,n){var r=function(){};return r.prototype=new t,r.prototype.constructor=r,r.prototype.parent=t.prototype,r.prototype=e.extend(r.prototype,n),r}if(window.Select2!==t)return;var n,r,i,s,o,u;n={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){e=e.which?e.which:e;switch(e){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case n.SHIFT:case n.CTRL:case n.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123}},o=function(){var e=1;return function(){return e++}}(),e(document).delegate("body","mousemove",function(t){e.data(document,"select2-lastpos",{x:t.pageX,y:t.pageY})}),e(document).ready(function(){e(document).delegate("body","mousedown touchend",function(n){var r=e(n.target).closest("div.select2-container").get(0),i;r?e(document).find("div.select2-container-active").each(function(){this!==r&&e(this).data("select2").blur()}):(r=e(n.target).closest("div.select2-drop").get(0),e(document).find("div.select2-drop-active").each(function(){this!==r&&e(this).data("select2").blur()})),r=e(n.target),i=r.attr("for"),"LABEL"===n.target.tagName&&i&&i.length>0&&(r=e("#"+i),r=r.data("select2"),r!==t&&(r.focus(),n.preventDefault()))})}),r=k(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var r,i,s=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&n.element.data("select2")!==null&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+o()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=v(function(){return n.element.closest("body")}),n.element.attr("class")!==t&&this.container.addClass(n.element.attr("class").replace(/validate\[[\S ]+] ?/,"")),this.container.css(T(n.containerCss)),this.container.addClass(T(n.containerCssClass)),this.opts.element.data("select2",this).hide().before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(T(n.dropdownCssClass)),this.dropdown.data("select2",this),this.results=r=this.container.find(s),this.search=i=this.container.find("input.select2-input"),i.attr("tabIndex",this.opts.element.attr("tabIndex")),this.resultsPage=0,this.context=null,this.initContainer(),this.initContainerWidth(),p(this.results),this.dropdown.delegate(s,"mousemove-filtered",this.bind(this.highlightUnderEvent)),m(80,this.results),this.dropdown.delegate(s,"scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&r.mousewheel(function(e,t,n,i){var s=r.scrollTop(),o;i>0&&s-i<=0?(r.scrollTop(0),g(e)):i<0&&r.get(0).scrollHeight-r.scrollTop()+i<=r.height()&&(r.scrollTop(r.get(0).scrollHeight-r.height()),g(e))}),h(i),i.bind("keyup-change",this.bind(this.updateResults)),i.bind("focus",function(){i.addClass("select2-focused"),i.val()===" "&&i.val("")}),i.bind("blur",function(){i.removeClass("select2-focused")}),this.dropdown.delegate(s,"mouseup",this.bind(function(t){e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0?(this.highlightUnderEvent(t),this.selectHighlighted(t)):this.focusSearch(),g(t)})),this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),(n.element.is(":disabled")||n.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(n){var r,i,s,o;r=n.element,r.get(0).tagName.toLowerCase()==="select"&&(this.select=i=n.element),i&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(r,i,s){var o,u,a,f,l=this.opts.id,c=this;o=function(r,i,u){var a,f,h,p,d,v,m,g,y;for(a=0,f=r.length;a<f;a+=1)h=r[a],p=l(h)!==t,d=h.children&&h.children.length>0,v=e("<li></li>"),v.addClass("select2-results-dept-"+u),v.addClass("select2-result"),v.addClass(p?"select2-result-selectable":"select2-result-unselectable"),d&&v.addClass("select2-result-with-children"),v.addClass(c.opts.formatResultCssClass(h)),m=e("<div></div>"),m.addClass("select2-result-label"),y=n.formatResult(h,m,s),y!==t&&m.html(c.opts.escapeMarkup(y)),v.append(m),d&&(g=e("<ul></ul>"),g.addClass("select2-result-sub"),o(h.children,g,u+1),v.append(g)),v.data("select2-data",h),i.append(v)},o(i,r,0)}},e.fn.select2.defaults,n),typeof n.id!="function"&&(s=n.id,n.id=function(e){return e[s]}),i?(n.query=this.bind(function(n){var i={results:[],more:!1},s=n.term,o,u,a;a=function(e,t){var r;e.is("option")?n.matcher(s,e.text(),e)&&t.push({id:e.attr("value"),text:e.text(),element:e.get(),css:e.attr("class")}):e.is("optgroup")&&(r={text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")},e.children().each2(function(e,t){a(t,r.children)}),r.children.length>0&&t.push(r))},o=r.children(),this.getPlaceholder()!==t&&o.length>0&&(u=o[0],e(u).text()===""&&(o=o.not(u))),o.each2(function(e,t){a(t,i.results)}),n.callback(i)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(o=n.element.data("ajax-url"),o&&o.length>0&&(n.ajax.url=o),n.query=w(n.ajax)):"data"in n?n.query=E(n.data):"tags"in n&&(n.query=S(n.tags),n.createSearchChoice=function(e){return{id:e,text:e}},n.initSelection=function(t,r){var i=[];e(l(t.val(),n.separator)).each(function(){var t=this,r=this,s=n.tags;e.isFunction(s)&&(s=s()),e(s).each(function(){if(f(this.id,t))return r=this.text,!1}),i.push({id:t,text:r})}),r(i)}));if(typeof n.query!="function")throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){if(this.enabled)return;this.enabled=!0,this.container.removeClass("select2-container-disabled")},disable:function(){if(!this.enabled)return;this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t=this.container.offset(),n=this.container.outerHeight(),r=this.container.outerWidth(),i=this.dropdown.outerHeight(),s=e(window).scrollTop()+document.documentElement.clientHeight,o=t.top+n,u=t.left,a=o+i<=s,f=t.top-i>=this.body().scrollTop(),l=this.dropdown.hasClass("select2-drop-above"),c,h,p;this.body().css("position")!=="static"&&(c=this.body().offset(),o-=c.top,u-=c.left),l?(h=!0,!f&&a&&(h=!1)):(h=!1,!a&&f&&(h=!0)),h?(o=t.top-i,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),p=e.extend({top:o,left:u,width:r},T(this.opts.dropdownCss)),this.dropdown.css(p)},shouldOpen:function(){var t;return this.opened()?!1:(t=e.Event("open"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(window.setTimeout(this.bind(this.opening),1),!0):!1},opening:function(){var t=this.containerId,n=this.containerSelector,r="scroll."+t,i="resize."+t;this.container.parents().each(function(){e(this).bind(r,function(){var t=e(n);t.length==0&&e(this).unbind(r),t.select2("close")})}),e(window).bind(i,function(){var t=e(n);t.length==0&&e(window).unbind(i),t.select2("close")}),this.clearDropdownAlignmentPreference(),this.search.val()===" "&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible(),this.focusSearch()},close:function(){if(!this.opened())return;var t=this;this.container.parents().each(function(){e(this).unbind("scroll."+t.containerId)}),e(window).unbind("resize."+this.containerId),this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.opts.element.trigger(e.Event("close"))},clearSearch:function(){},ensureHighlightVisible:function(){var t=this.results,n,r,i,s,o,u,a;r=this.highlight();if(r<0)return;if(r==0){t.scrollTop(0);return}n=t.find(".select2-result-selectable"),i=e(n[r]),s=i.offset().top+i.outerHeight(),r===n.length-1&&(a=t.find("li.select2-more-results"),a.length>0&&(s=a.offset().top+a.outerHeight())),o=t.offset().top+t.outerHeight(),s>o&&t.scrollTop(t.scrollTop()+(s-o)),u=i.offset().top-t.offset().top,u<0&&t.scrollTop(t.scrollTop()+u)},moveHighlight:function(t){var n=this.results.find(".select2-result-selectable"),r=this.highlight();while(r>-1&&r<n.length){r+=t;var i=e(n[r]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")){this.highlight(r);break}}},highlight:function(t){var n=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0)return a(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1),t<0&&(t=0),n.removeClass("select2-highlighted"),e(n[t]).addClass("select2-highlighted"),this.ensureHighlightVisible()},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var r=this.results.find(".select2-result-selectable");this.highlight(r.index(n))}else n.length==0&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),n,r=-1,i=this.resultsPage+1,s=this,o=this.search.val(),u=this.context;if(t.length===0)return;n=t.offset().top-e.offset().top-e.height(),n<=0&&(t.addClass("select2-active"),this.opts.query({term:o,page:i,context:u,matcher:this.opts.matcher,callback:this.bind(function(n){if(!s.opened())return;s.opts.populateResults.call(this,e,n.results,{term:o,page:i,context:u}),n.more===!0?(t.detach().appendTo(e).text(s.opts.formatLoadMore(i+1)),window.setTimeout(function(){s.loadMoreIfNeeded()},10)):t.remove(),s.positionDropdown(),s.resultsPage=i})}))},tokenize:function(){},updateResults:function(n){function l(){i.scrollTop(0),r.removeClass("select2-active"),u.positionDropdown()}function c(e){i.html(u.opts.escapeMarkup(e)),l()}var r=this.search,i=this.results,s=this.opts,o,u=this,a;if(n!==!0&&(this.showSearchInput===!1||!this.opened()))return;r.addClass("select2-active");if(s.maximumSelectionSize>=1){o=this.data();if(e.isArray(o)&&o.length>=s.maximumSelectionSize&&x(s.formatSelectionTooBig,"formatSelectionTooBig")){c("<li class='select2-selection-limit'>"+s.formatSelectionTooBig(s.maximumSelectionSize)+"</li>");return}}if(r.val().length<s.minimumInputLength&&x(s.formatInputTooShort,"formatInputTooShort")){c("<li class='select2-no-results'>"+s.formatInputTooShort(r.val(),s.minimumInputLength)+"</li>");return}c("<li class='select2-searching'>"+s.formatSearching()+"</li>"),a=this.tokenize(),a!=t&&a!=null&&r.val(a),this.resultsPage=1,s.query({term:r.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(o){var a;if(!this.opened())return;this.context=o.context===t?null:o.context,this.opts.createSearchChoice&&r.val()!==""&&(a=this.opts.createSearchChoice.call(null,r.val(),o.results),a!==t&&a!==null&&u.id(a)!==t&&u.id(a)!==null&&e(o.results).filter(function(){return f(u.id(this),u.id(a))}).length===0&&o.results.unshift(a));if(o.results.length===0&&x(s.formatNoMatches,"formatNoMatches")){c("<li class='select2-no-results'>"+s.formatNoMatches(r.val())+"</li>");return}i.empty(),u.opts.populateResults.call(this,i,o.results,{term:r.val(),page:this.resultsPage,context:null}),o.more===!0&&x(s.formatLoadMore,"formatLoadMore")&&(i.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(s.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(o,n),l()})})},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){this.search.show(),this.search.focus(),window.setTimeout(this.bind(function(){this.search.show(),this.search.focus(),this.search.val(this.search.val())}),10)},selectHighlighted:function(){var e=this.highlight(),t=this.results.find(".select2-highlighted").not(".select2-disabled"),n=t.closest(".select2-result-selectable").data("select2-data");n&&(t.addClass("select2-disabled"),this.highlight(e),this.onSelect(n))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function n(){var n,r,i,s,o;if(this.opts.width==="off")return null;if(this.opts.width==="element")return this.opts.element.outerWidth()===0?"auto":this.opts.element.outerWidth()+"px";if(this.opts.width==="copy"||this.opts.width==="resolve"){n=this.opts.element.attr("style");if(n!==t){r=n.split(";");for(s=0,o=r.length;s<o;s+=1){i=r[s].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(i!==null&&i.length>=1)return i[1]}}return this.opts.width==="resolve"?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:this.opts.element.outerWidth()===0?"auto":this.opts.element.outerWidth()+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var r=n.call(this);r!==null&&this.container.attr("style","width: "+r)}}),i=k(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container"}).html(["    <a href='#' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},opening:function(){this.search.show(),this.parent.opening.apply(this,arguments),this.dropdown.removeClass("select2-offscreen")},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments),this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show()},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var e,t=this.container,r=this.dropdown,i=!1;this.selection=e=t.find(".select2-choice"),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){g(e);return}if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),g(e);return;case n.TAB:case n.ENTER:this.selectHighlighted(),g(e);return;case n.ESC:this.cancel(e),g(e);return}else{if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open();if(e.which===n.ENTER)return}})),this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")})),this.search.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("mousedown",this.bind(function(e){i=!0,this.opened()?(this.close(),this.selection.focus()):this.enabled&&this.open(),i=!1})),r.bind("mousedown",this.bind(function(){this.search.focus()})),e.bind("focus",this.bind(function(){this.container.addClass("select2-container-active"),this.search.attr("tabIndex","-1")})),e.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){g(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;if(e.which==n.DELETE){this.opts.allowClear&&this.clear();return}this.open();if(e.which===n.ENTER){g(e);return}if(e.which<48){g(e);return}var t=String.fromCharCode(e.which).toLowerCase();e.shiftKey&&(t=t.toUpperCase()),this.search.focus(),this.search.val(t),g(e)})),e.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear(),g(e),this.close(),this.triggerChange(),this.selection.focus()})),this.setPlaceholder(),this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){var e;if(this.opts.element.val()==="")this.close(),this.setPlaceholder();else{var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=t.find(":selected");e.isFunction(n)&&n({id:r.attr("value"),text:r.text()})}),t},setPlaceholder:function(){var e=this.getPlaceholder();if(this.opts.element.val()===""&&e!==t){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.selection.find("abbr").hide()}},postprocessResults:function(t,n){var r=0,i=this,s=!0;this.results.find(".select2-result-selectable").each2(function(e,t){if(f(i.id(t.data("select2-data")),i.opts.element.val()))return r=e,!1}),this.highlight(r),n===!0&&(s=this.showSearchInput=N(t.results)>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[s?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[s?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),f(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var n=this.selection.find("span"),r;this.selection.data("select2-data",e),n.empty(),r=this.opts.formatSelection(e,n),r!==t&&n.append(this.opts.escapeMarkup(r)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,n=null,r=this;if(arguments.length===0)return this.opts.element.val();e=arguments[0];if(this.select)this.select.val(e).find(":selected").each2(function(e,t){return n={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(n),this.setPlaceholder();else{if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");if(!e){this.clear();return}this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){r.opts.element.val(e?r.id(e):""),r.updateSelection(e),r.setPlaceholder()})}},clearSearch:function(){this.search.val("")},data:function(e){var n;if(arguments.length===0)return n=this.selection.data("select2-data"),n==t&&(n=null),n;!e||e===""?this.clear():(this.opts.element.val(e?this.id(e):""),this.updateSelection(e))}}),s=k(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=[];t.find(":selected").each2(function(e,t){r.push({id:t.attr("value"),text:t.text()})}),e.isFunction(n)&&n(r)}),t},initContainer:function(){var t=".select2-choices",r;this.searchContainer=this.container.find(".select2-search-field"),this.selection=r=this.container.find(t),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.BACKSPACE&&this.search.val()===""){this.close();var t,i=r.find(".select2-search-choice-focus");if(i.length>0){this.unselect(i.first()),this.search.width(10),g(e);return}t=r.find(".select2-search-choice"),t.length>0&&t.last().addClass("select2-search-choice-focus")}else r.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),g(e);return;case n.ENTER:case n.TAB:this.selectHighlighted(),g(e);return;case n.ESC:this.cancel(e),g(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.BACKSPACE||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open(),(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN)&&g(e)})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.clearSearch(),e.stopImmediatePropagation()})),this.container.delegate(t,"mousedown",this.bind(function(t){if(!this.enabled)return;if(e(t.target).closest(".select2-search-choice").length>0)return;this.clearPlaceholder(),this.open(),this.focusSearch(),t.preventDefault()})),this.container.delegate(t,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder()})),this.clearSearch()},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments),this.search.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments),this.search.attr("disabled",!0)},initSelection:function(){var e;this.opts.element.val()===""&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||this.opts.element.val()!==""){var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&this.getVal().length===0&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.resizeSearch()):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):this.search.val()===" "&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments),this.clearPlaceholder(),this.resizeSearch(),this.focusSearch()},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],i=this;e(t).each(function(){a(i.id(this),n)<0&&(n.push(i.id(this)),r.push(this))}),t=r,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){i.addSelectedChoice(this)}),i.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts),e!=null&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e){this.addSelectedChoice(e),this.select&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.positionDropdown()):this.close(),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(t){var n=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),r=this.id(t),i=this.getVal(),s;s=this.opts.formatSelection(t,n),n.find("div").replaceWith("<div>"+this.opts.escapeMarkup(s)+"</div>"),n.find(".select2-search-choice-close").bind("mousedown",g).bind("click dblclick",this.bind(function(t){if(!this.enabled)return;e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),g(t)})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active")})),n.data("select2-data",t),n.insertBefore(this.searchContainer),i.push(r),this.setVal(i)},unselect:function(e){var t=this.getVal(),n,r;e=e.closest(".select2-search-choice");if(e.length===0)throw"Invalid argument: "+e+". Must be .select2-search-choice";n=e.data("select2-data"),r=a(this.id(n),t),r>=0&&(t.splice(r,1),this.setVal(t),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:n})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),n=this.results.find(".select2-result-with-children"),r=this;t.each2(function(t,n){var i=r.id(n.data("select2-data"));a(i,e)>=0?n.addClass("select2-disabled").removeClass("select2-result-selectable"):n.removeClass("select2-disabled").addClass("select2-result-selectable")}),n.each2(function(e,t){t.find(".select2-result-selectable").length==0?t.addClass("select2-disabled"):t.removeClass("select2-disabled")}),t.each2(function(e,t){if(!t.hasClass("select2-disabled")&&t.hasClass("select2-result-selectable"))return r.highlight(0),!1})},resizeSearch:function(){var e,t,n,r,i,s=c(this.search);e=y(this.search)+10,t=this.search.offset().left,n=this.selection.width(),r=this.selection.offset().left,i=n-(t-r)-s,i<e&&(i=n-s),i<40&&(i=n-s),this.search.width(i)},getVal:function(){var e;return this.select?(e=this.select.val(),e===null?[]:e):(e=this.opts.element.val(),l(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){a(this,n)<0&&n.push(this)}),this.opts.element.val(n.length===0?"":n.join(this.opts.separator)))},val:function(){var n,r=[],i=this;if(arguments.length===0)return this.getVal();n=arguments[0];if(!n){this.opts.element.val(""),this.updateSelection([]),this.clearSearch();return}this.setVal(n);if(this.select)this.select.find(":selected").each(function(){r.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(r);else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e(t).map(i.id);i.setVal(n),i.updateSelection(t),i.clearSearch()})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t){var n=this,r;if(arguments.length===0)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();t||(t=[]),r=e.map(t,function(e){return n.opts.id(e)}),this.setVal(r),this.updateSelection(t),this.clearSearch()}}),e.fn.select2=function(){var n=Array.prototype.slice.call(arguments,0),r,o,u,f,l=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];return this.each(function(){if(n.length===0||typeof n[0]=="object")r=n.length===0?{}:e.extend({},n[0]),r.element=e(this),r.element.get(0).tagName.toLowerCase()==="select"?f=r.element.attr("multiple"):(f=r.multiple||!1,"tags"in r&&(r.multiple=f=!0)),o=f?new s:new i,o.init(r);else{if(typeof n[0]!="string")throw"Invalid arguments to select2 plugin: "+n;if(a(n[0],l)<0)throw"Unknown method: "+n[0];u=t,o=e(this).data("select2");if(o===t)return;n[0]==="container"?u=o.container:u=o[n[0]].apply(o,n.slice(1));if(u!==t)return!1}}),u===t?this:u},e.fn.select2.defaults={width:"copy",closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n){var r=[];return b(e.text,n.term,r),r.join("")},formatSelection:function(e,n){return e?e.text:t},formatResultCssClass:function(e){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(e==1?"":"s")},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:C,escapeMarkup:function(e){return e&&typeof e=="string"?e.replace(/&/g,"&amp;"):e},blurOnChange:!1},window.Select2={query:{ajax:w,local:E,tags:S},util:{debounce:d,markMatch:b},"class":{"abstract":r,single:i,multi:s}}}(e),!0}),define("instance-admin/utils/select2-helpers",["jquery","underscore","jquery.select2"],function(e,t){var n={};return n.create_arguments_for_model=function(n){var r=n.lookup_term||"name";return{placeholder:n.placeholder,allowClear:!0,ajax:{url:n.url,data:function(e,t){var n={};return n[r]=e,n},results:function(e,n){var i=t.map(e,function(e){return{id:e.id,text:e[r]}});return{results:i}}},createSearchChoice:function(e){return n.no_creation?null:{id:0,text:e}},formatSelection:function(e,t){var n=e.text;return e.id||(n+=" <em>(new entry)</em>"),n},formatResult:function(t,r){var i=e("<span>").text(t.text);return n.no_creation?i:(i.append(t.id?"<em> &larr; select to use existing entry</em>":"<em> &larr; select to create new entry</em>"),i)}}},n.create_arguments_for_autocompleter=function(e){return{placeholder:e.placeholder,allowClear:!0,ajax:{url:e.autocomplete_url,data:function(e,t){return{term:e}},results:function(e,n){return{results:t.map(e,function(e){return{id:e,text:e}})}}},createSearchChoice:function(e){return{id:e,text:e}}}},n.create_model_if_needed_for_data=function(e,t){return function(n){t===null?n.resolve(null):t.id?n.resolve(t.id):(new e({name:t.text})).save({},{success:function(e,t){n.resolve(t.id)},error:function(e,t){n.reject(t)}})}},n}),define("instance-admin/views/membership-new",["jquery","Backbone","backbone-forms","underscore","text!templates/membership/new.html","instance-admin/models/person","instance-admin/models/organization","instance-admin/models/membership","instance-admin/models/post","instance-admin/utils/select2-helpers"],function(e,t,n,r,i,s,o,u,a,f){var l=t.View.extend({membershipTemplate:r.template(i),render:function(){var t=this,n=e(this.membershipTemplate());this.$errors_list=n.find("ul.error");var i=["role","label","person_id","organization_id","post_id","start_date","end_date","area_id","area_name"],s=["label","start_date","end_date"];r.each(i,function(e){t["$"+e+"_input"]=n.find("[name="+e+"]")}),r.each(s,function(e){t["$"+e+"_input"].val(t.model.get(e))});var o=t.model.get("area");o&&(t.$area_id_input.val(o.id),t.$area_name_input.val(o.name)),this.$role_input.select2(f.create_arguments_for_autocompleter({placeholder:"e.g President, CEO, Professor, Coach",autocomplete_url:"/autocomplete/memberships"})),this.$person_id_input.select2(f.create_arguments_for_model({placeholder:"e.g Joe Bloggs, Jane Smith",url:"/autocomplete/persons",errors_list:this.$errors_list})),this.$organization_id_input.select2(f.create_arguments_for_model({placeholder:"e.g Apple Inc, UK Parliament, Kenyatta University",url:"/autocomplete/organizations",errors_list:this.$errors_list})),this.$post_id_input.select2(f.create_arguments_for_model({placeholder:"e.g MP for Avalon, President of the US",url:"/autocomplete/posts",lookup_term:"label",no_creation:!0,errors_list:this.$errors_list}));var u={person_id:["id","name"],organization_id:["id","name"],post_id:["id","label"],role:["",""]};return r.each(u,function(e,n){var r=t.model.get(n);if(r){var i=e[0]?r[e[0]]:r,s=e[1]?r[e[1]]:r;t["$"+n+"_input"].select2("data",{id:i,text:s})}}),this.options.fields_to_hide.person&&n.find("p.person").hide(),this.options.fields_to_hide.organization&&n.find("p.organization").hide(),this.$el.html(n),this},events:{"submit form":"submitForm"},submitForm:function(t){t.preventDefault();var n=this,i={},u=!1;n.$errors_list.html("");var a=n.$role_input.select2("data");i.role=a?a.text:null;var l=n.$post_id_input.select2("data");i.post_id=l?l.id:null;var c=["label","start_date","end_date","area_id","area_name"];r.each(c,function(e){i[e]=n["$"+e+"_input"].val()||null});var h=/^[0-9]{4}(-[0-9]{2}){0,2}$/;i.start_date&&!i.start_date.match(h)&&(n.$errors_list.append("<li>Start date not in correct format.</li>"),u=!0),i.end_date&&!i.end_date.match(h)&&(n.$errors_list.append("<li>End date not in correct format.</li>"),u=!0);if(u)return;i.area_id&&(i.area={id:i.area_id,name:i.area_name},delete i.area_id,delete i.area_name),e.when(e.Deferred(f.create_model_if_needed_for_data(s,n.$person_id_input.select2("data"))),e.Deferred(f.create_model_if_needed_for_data(o,n.$organization_id_input.select2("data")))).then(function(e,t){if(!e||!t){n.$errors_list.append("<li>You must specify a person and an organization.</li>");return}i.person_id=e,i.organization_id=t,n.model.save(i,{success:function(e,t){document.location.reload()},error:function(e,t){n.$errors_list.append("<li>Something went wrong saving the membership to the server.</li>")}})})}});return l}),define("text!templates/membership/remove.html",[],function(){return'<div id="remove-membership">\n  <form name="remove-membership" method="post">\n    <input type=\'submit\' value="Really delete this membership?">\n  </form>\n</div>\n'}),define("instance-admin/actions/membership-add-remove",["jquery","instance-admin/models/membership","instance-admin/models/person","instance-admin/models/organization","instance-admin/views/membership-new","instance-admin/views/remove-model","text!templates/membership/remove.html","jquery.fancybox"],function(e,t,n,r,i,s,o){e(function(){function t(e){var t=e.closest("li"),i=t.data("id"),s=popit.model.memberships,o;if(i){o=s.get(i),o.fetch({async:!1});if(popit.type=="person"){o.set("person_id",popit.model.attributes);var u=new r({id:o.get("organization_id")});u.fetch({async:!1}),o.set("organization_id",u.attributes)}else if(popit.type=="organization"){o.set("organization_id",popit.model.attributes);var a=new n({id:o.get("person_id")});a.fetch({async:!1}),o.set("person_id",a.attributes)}o.exists=!0}else{var f={};popit.type=="person"?f.person_id=popit.model.attributes:popit.type=="organization"&&(f.organization_id=popit.model.attributes),o=new s.model(f,{collection:s}),o.exists=!1}return o}e(".edit-membership").click(function(n){n.preventDefault();var r=t(e(this)),s={};popit.type=="person"?s.person=!0:popit.type=="organization"&&(s.organization=!0);var o=new i({model:r,fields_to_hide:s});e.fancybox(o.render().el)}),e(".delete-membership").click(function(n){n.preventDefault();var r=e(this),i=r.closest("li"),u=t(r),a=new s({model:u,template:o,submitSuccess:function(t,n){i.remove(),e.fancybox.close(),this.remove()}});e.fancybox(a.render().el)})})}),define("jqueryui/core",["jquery"],function(e){(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;return!t.href||!o||s.nodeName.toLowerCase()!=="map"?!1:(u=e("img[usemap=#"+o+"]")[0],!!u&&r(u))}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"@VERSION",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),s&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.curCSS||(e.curCSS=e.css),e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r)i.plugins[s]=i.plugins[s]||[],i.plugins[s].push([n,r[s]])},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(e)}),define("jqueryui/widget",["jquery"],function(e){(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}})(e)}),define("jqueryui/position",["jquery"],function(e){(function(e,t){e.ui=e.ui||{};var n=/left|center|right/,r=/top|center|bottom/,i="center",s={},o=e.fn.position,u=e.fn.offset;e.fn.position=function(t){if(!t||!t.of)return o.apply(this,arguments);t=e.extend({},t);var u=e(t.of),a=u[0],f=(t.collision||"flip").split(" "),l=t.offset?t.offset.split(" "):[0,0],c,h,p;return a.nodeType===9?(c=u.width(),h=u.height(),p={top:0,left:0}):a.setTimeout?(c=u.width(),h=u.height(),p={top:u.scrollTop(),left:u.scrollLeft()}):a.preventDefault?(t.at="left top",c=h=0,p={top:t.of.pageY,left:t.of.pageX}):(c=u.outerWidth(),h=u.outerHeight(),p=u.offset()),e.each(["my","at"],function(){var e=(t[this]||"").split(" ");e.length===1&&(e=n.test(e[0])?e.concat([i]):r.test(e[0])?[i].concat(e):[i,i]),e[0]=n.test(e[0])?e[0]:i,e[1]=r.test(e[1])?e[1]:i,t[this]=e}),f.length===1&&(f[1]=f[0]),l[0]=parseInt(l[0],10)||0,l.length===1&&(l[1]=l[0]),l[1]=parseInt(l[1],10)||0,t.at[0]==="right"?p.left+=c:t.at[0]===i&&(p.left+=c/2),t.at[1]==="bottom"?p.top+=h:t.at[1]===i&&(p.top+=h/2),p.left+=l[0],p.top+=l[1],this.each(function(){var n=e(this),r=n.outerWidth(),o=n.outerHeight(),u=parseInt(e.curCSS(this,"marginLeft",!0))||0,a=parseInt(e.curCSS(this,"marginTop",!0))||0,d=r+u+(parseInt(e.curCSS(this,"marginRight",!0))||0),v=o+a+(parseInt(e.curCSS(this,"marginBottom",!0))||0),m=e.extend({},p),g;t.my[0]==="right"?m.left-=r:t.my[0]===i&&(m.left-=r/2),t.my[1]==="bottom"?m.top-=o:t.my[1]===i&&(m.top-=o/2),s.fractions||(m.left=Math.round(m.left),m.top=Math.round(m.top)),g={left:m.left-u,top:m.top-a},e.each(["left","top"],function(n,i){e.ui.position[f[n]]&&e.ui.position[f[n]][i](m,{targetWidth:c,targetHeight:h,elemWidth:r,elemHeight:o,collisionPosition:g,collisionWidth:d,collisionHeight:v,offset:l,my:t.my,at:t.at})}),e.fn.bgiframe&&n.bgiframe(),n.offset(e.extend(m,{using:t.using}))})},e.ui.position={fit:{left:function(t,n){var r=e(window),i=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();t.left=i>0?t.left-i:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window),i=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();t.top=i>0?t.top-i:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]===i)return;var r=e(window),s=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft(),o=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,u=n.at[0]==="left"?n.targetWidth:-n.targetWidth,a=-2*n.offset[0];t.left+=n.collisionPosition.left<0?o+u+a:s>0?o+u+a:0},top:function(t,n){if(n.at[1]===i)return;var r=e(window),s=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop(),o=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,u=n.at[1]==="top"?n.targetHeight:-n.targetHeight,a=-2*n.offset[1];t.top+=n.collisionPosition.top<0?o+u+a:s>0?o+u+a:0}}},e.offset.setOffset||(e.offset.setOffset=function(t,n){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",!0),10)||0,o=parseInt(e.curCSS(t,"left",!0),10)||0,u={top:n.top-i.top+s,left:n.left-i.left+o};"using"in n?n.using.call(t,u):r.css(u)},e.fn.offset=function(t){var n=this[0];return!n||!n.ownerDocument?null:t?e.isFunction(t)?this.each(function(n){e(this).offset(t.call(this,n,e(this).offset()))}):this.each(function(){e.offset.setOffset(this,t)}):u.call(this)}),function(){var t=document.getElementsByTagName("body")[0],n=document.createElement("div"),r,i,o,u,a;r=document.createElement(t?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},t&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"});for(var f in o)r.style[f]=o[f];r.appendChild(n),i=t||document.documentElement,i.insertBefore(r,i.firstChild),n.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",u=e(n).offset(function(e,t){return t}).offset(),r.innerHTML="",i.removeChild(r),a=u.top+u.left+(t?2e3:0),s.fractions=a>21&&a<22}()})(e)}),define("jqueryui/autocomplete",["jquery","./core","./widget","./position"],function(e){(function(e,t){var n=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(t.options.disabled||t.element.propAttr("readOnly"))return;r=!1;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._keyEvent("previous",n);break;case i.DOWN:t._keyEvent("next",n);break;case i.ENTER:case i.NUMPAD_ENTER:t.menu.active&&(r=!0,n.preventDefault());case i.TAB:if(!t.menu.active)return;t.menu.select(n);break;case i.ESCAPE:t.element.val(t.term),t.close(n);break;default:clearTimeout(t.searching),t.searching=setTimeout(function(){t.term!=t.element.val()&&(t.selectedItem=null,t.search(null,n))},t.options.delay)}}).bind("keypress.autocomplete",function(e){r&&(r=!1,e.preventDefault())}).bind("focus.autocomplete",function(){if(t.options.disabled)return;t.selectedItem=null,t.previous=t.element.val()}).bind("blur.autocomplete",function(e){if(t.options.disabled)return;clearTimeout(t.searching),t.closing=setTimeout(function(){t.close(e),t._change(e)},150)}),this._initSource(),this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.ui.contains(r,n.target)&&t.close()})},1),setTimeout(function(){clearTimeout(t.closing)},13)}).menu({focus:function(e,n){var r=n.item.data("item.autocomplete");!1!==t._trigger("focus",e,{item:r})&&/^key/.test(e.originalEvent.type)&&t.element.val(r.value)},selected:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;t.element[0]!==n.activeElement&&(t.element.focus(),t.previous=s,setTimeout(function(){t.previous=s,t.selectedItem=i},1)),!1!==t._trigger("select",e,{item:i})&&t.element.val(i.value),t.term=t.element.val(),t.close(e),t.selectedItem=i},blur:function(e,n){t.menu.element.is(":visible")&&t.element.val()!==t.term&&t.element.val(t.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe(),t.beforeunloadHandler=function(){t.element.removeAttr("autocomplete")},e(window).bind("beforeunload",t.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e(window).unbind("beforeunload",this.beforeunloadHandler),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t==="source"&&this._initSource(),t==="appendTo"&&this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]),t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var t=this,n,r;e.isArray(this.options.source)?(n=this.options.source,this.source=function(t,r){r(e.ui.autocomplete.filter(n,t.term))}):typeof this.options.source=="string"?(r=this.options.source,this.source=function(n,i){t.xhr&&t.xhr.abort(),t.xhr=e.ajax({url:r,data:n,dataType:"json",success:function(e,t){i(e)},error:function(){i([])}})}):this.source=this.options.source},search:function(e,t){e=e!=null?e:this.element.val(),this.term=this.element.val();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close()},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.deactivate(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this.element.val(this.term),this.menu.deactivate();return}this.menu[e](t)},widget:function(){return this.menu.element},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})})(e),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){if(!e(n.target).closest(".ui-menu-item a").length)return;n.preventDefault(),t.select(n)}),this.refresh()},refresh:function(){var t=this,n=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");n.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){t.activate(n,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){this.deactivate();if(this.hasScroll()){var n=t.offset().top-this.element.offset().top,r=this.element.scrollTop(),i=this.element.height();n<0?this.element.scrollTop(r+n):n>=i&&this.element.scrollTop(r+n-i+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,n){if(!this.active){this.activate(n,this.element.children(t));return}var r=this.active[e+"All"](".ui-menu-item").eq(0);r.length?this.activate(n,r):this.activate(n,this.element.children(t))},nextPage:function(t){if(this.hasScroll()){if(!this.active||this.last()){this.activate(t,this.element.children(".ui-menu-item:first"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n-r+e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:last")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll()){if(!this.active||this.first()){this.activate(t,this.element.children(".ui-menu-item:last"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n+r-e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:first")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(e)}),define("instance-admin/views/list-item-edit",["jquery","underscore","Backbone","backbone-forms","instance-admin/views/submit-form-helper","jqueryui/autocomplete"],function(e,t,n,r,i){var s=n.View.extend({initialize:function(){this.form=new r({model:this.model})},render:function(){var n=this.model.schema,r=e(this.form.render().el);r.find("ul").first().append('<input type="submit" name="save" value="Save" />').append('<a class="delete"><i class="foundicon-trash"></i> Delete</a> ').append('<a class="cancel">Cancel</a>');var i=t.filter(t.keys(n),function(e){return n[e].autocomplete_source});return t.each(i,function(e){var t=n[e].autocomplete_source;r.find('input[name="'+e+'"]').autocomplete({source:t})}),this.$el.html(r),this},events:{"submit form":"submitForm","click a.cancel":"cancelEntry","click a.delete":"deleteEntry"},deleteEntry:function(e){e.preventDefault(),this.model.destroy(),this.remove()},cancelEntry:function(e){e.preventDefault(),this.model.exists?this.render_listing():this.remove()},render_listing:function(){var e={item:this.model.toJSON()};return this.$el.html(this.options.template(e)),this},submitForm:function(e){e.preventDefault();var n=this.form,r=this.model,i=n.commit();t.isEmpty(i)&&(this.render_listing(),r.direct&&r.save(),r.exists||r.collection.add(r,{at:0}),this.undelegateEvents())}});return s}),define("instance-admin/actions/list-item-editor",["jquery","underscore","instance-admin/views/list-item-edit"],function(e,t,n){return function(r){var i=r.collection,s=r.defaults||{};return function(o){o.preventDefault();var u=e(this),a=u.closest("li");a.length||(a=e("<li/>"),u.closest("section").find("ul").prepend(a));var f=a.data("id"),l;f?(l=i.get(f),l.exists=!0):(l=new i.model(s,{collection:i}),l.exists=!1,a.data("id",l.cid)),l.direct=r.direct;var c=new n({template:t.template(r.template),model:l,el:a});c.render()}}}),define("text!templates/post/view.html",[],function(){return'<span class="admin-options hover-only">\n  <a class="edit edit-post"><i class="foundicon-edit"></i> <span>Edit</span></a>\n</span>\n<%- item.label %><% if (item.role) { %> (<%- item.role %>)<% } %>\n\n<% if (item.start_date || item.end_date) { %>\n  (\n  <% if (item.start_date) { %>\n    from <%- item.start_date %>\n  <% } %>\n  <% if (item.end_date) { %>\n    to <%- item.end_date %>\n  <% } %>\n  )\n<% } %>\n'}),define("instance-admin/actions/post-edit",["jquery","instance-admin/actions/list-item-editor","instance-admin/collections/posts","text!templates/post/view.html","jquery.fancybox"],function(e,t,n,r){e(function(){if(typeof popit=="undefined")return;e("#content").on("click",".edit-post",new t({collection:popit.model.posts,defaults:{organization_id:popit.model.id},direct:!0,template:r}))})}),define("text!templates/contact/view.html",[],function(){return'<span class="admin-options hover-only">\n  <a class="edit contact-edit"><i class="foundicon-edit"></i> <span>Edit</span></a>\n</span>\n<div class="list-item-title">\n  <% if (item.label) { %>\n    <%- item.label %> (<%- item.type %>):\n  <% } else { %>\n    <%- item.type %>:\n  <% } %>\n</div>\n<div class="list-item-value">\n  <%- item.value %>\n  <% if (item.note) { %>(<%- item.note %>)<% } %>\n</div>\n'}),define("instance-admin/actions/contact-edit",["jquery","instance-admin/actions/list-item-editor","text!templates/contact/view.html"],function(e,t,n){e(function(){if(typeof popit=="undefined")return;e("#content").on("click",".contact-edit",new t({collection:popit.model.get("contact_details"),template:n}))})}),define("text!templates/other_name/view.html",[],function(){return'<span class="admin-options hover-only">\n  <a class="edit other_name-edit"><i class="foundicon-edit"></i> <span>Edit</span></a>\n</span>\n\n<% if (item.note) { %><%- item.note %>: <% } %>\n<%- item.name %>\n<% if (item.start_date || item.end_date) { %>\n(<%- item.start_date || \'?\' %> &ndash; <%- item.end_date || \'?\' %>)\n<% } %>\n\n'}),define("instance-admin/actions/other_name-edit",["jquery","instance-admin/actions/list-item-editor","text!templates/other_name/view.html"],function(e,t,n){e(function(){if(typeof popit=="undefined")return;e("#content").on("click",".other_name-edit",new t({collection:popit.model.get("other_names"),template:n}))})}),define("text!templates/identifier/view.html",[],function(){return'<span class="admin-options hover-only">\n  <a class="edit identifier-edit"><i class="foundicon-edit"></i> <span>Edit</span></a>\n</span>\n\n<% if (item.scheme) { %><%- item.scheme %>: <% } %>\n<%- item.identifier %>\n'}),define("instance-admin/actions/identifier-edit",["jquery","instance-admin/actions/list-item-editor","text!templates/identifier/view.html"],function(e,t,n){e(function(){if(typeof popit=="undefined")return;e("#content").on("click",".identifier-edit",new t({collection:popit.model.get("identifiers"),template:n}))})}),define("text!templates/link/view.html",[],function(){return'<span class="admin-options hover-only">\n  <a class="edit link-edit"><i class="foundicon-edit"></i> <span>Edit</span></a>\n</span>\n<div class="list-item-title"><%- item.note %>: </div>\n<div class="list-item-value"><a href="<%- item.url %>"><%- item.url %></a></div>\n'}),define("instance-admin/actions/links-edit",["jquery","instance-admin/actions/list-item-editor","text!templates/link/view.html"],function(e,t,n){e(function(){if(typeof popit=="undefined")return;e("#content").on("click",".link-edit",new t({collection:popit.model.get("links"),template:n}))})}),function(){function e(e){var t=e.currentTarget||e.srcElement,n;if(e.type==="load"||s.test(t.readyState)){e=t.getAttribute("data-requiremodule"),u[e]=!0;for(e=0;n=o[e];e++){if(!u[n.name])break;n.req([n.name],n.onLoad)}e>0&&o.splice(0,e),setTimeout(function(){t.parentNode.removeChild(t)},15)}}function t(e){var t,n;e.setAttribute("data-orderloaded","loaded");for(e=0;n=f[e];e++){if(!(t=a[n])||t.getAttribute("data-orderloaded")!=="loaded")break;delete a[n],require.addScriptToDom(t)}e>0&&f.splice(0,e)}var n=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),r=n&&(n.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),i=n&&n.readyState==="uninitialized",s=/^(complete|loaded)$/,o=[],u={},a={},f=[],n=null;define("order",{version:"1.0.5",load:function(n,s,u,l){var c;s.nameToUrl?(c=s.nameToUrl(n,null),require.s.skipAsync[c]=!0,r||l.isBuild?s([n],u):i?(l=require.s.contexts._,!l.urlFetched[c]&&!l.loaded[n]&&(l.urlFetched[c]=!0,require.resourcesReady(!1),l.scriptCount+=1,c=require.attach(c,l,n,null,null,t),a[n]=c,f.push(n)),s([n],u)):s.specified(n)?s([n],u):(o.push({name:n,req:s,onLoad:u}),require.attach(c,null,n,e,"script/cache"))):s([n],u)}})}(),require(["augmenters/mailchecker","augmenters/migration","augmenters/slug-validation","augmenters/edit-in-place"]),require(["instance-admin/app","instance-admin/actions/photo-remove","instance-admin/actions/person-add-remove","instance-admin/actions/organization-add-remove","instance-admin/actions/membership-add-remove","instance-admin/actions/post-edit","instance-admin/actions/contact-edit","instance-admin/actions/other_name-edit","instance-admin/actions/identifier-edit","instance-admin/actions/links-edit"]),require(["order!jquery"],function(e){e.ajaxSetup({converters:{"text json":function(t){var n=e.parseJSON(t);return n?n.results||n.result||n:{}}}})}),define("run-instance-admin",function(){}),require(["require-config","run-instance-admin"]),define("main-instance-admin",function(){});